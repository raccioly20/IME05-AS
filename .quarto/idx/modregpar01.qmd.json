{"title":"Análise de Sobrevivência","markdown":{"yaml":{"title":"Análise de Sobrevivência","subtitle":"Modelos de regressão paramétricos","author":"Ricardo Accioly","format":"html"},"headingText":"Introdução","containsRefs":false,"markdown":"\n\n\nNesta etapa vamos começar a trabalhar com modelos de regressão paramétricos.\n\nOs modelos que vamos ver se denominam modelos de tempo de falha (vida) acelerado TFA (AFT).\n\nO conjunto de dados a seguir chamado \"anderson.xlsx\" consiste em tempos de remissão (em semanas) em 42 pacientes com leucemia, metade dos quais recebem uma certa nova terapia de tratamento e a outra metade recebe uma terapia de tratamento padrão. A variável de exposição de interesse é o tratamento (Rx = 0 se novo tratamento, Rx = 1 se tratamento padrão).\n\nDuas outras variáveis para controle como potenciais confundidores são a contagem de glóbulos brancos (ou seja, logwbc) e sexo. O status de falha é definido pela variável recaída (0 se censurado, 1 se falhar).\n\n### Carregando os dados\n\n```{r ex_1}\nlibrary(survival)\nlibrary(readxl)\ndados <- read_xlsx(\"anderson.xlsx\", col_names = TRUE )\nsummary(dados)\n\n```\n\n### Ajuste Não Paramétrico\n\n```{r ex_2}\nekm <- survfit(Surv(tempo,status)~Rx, data=dados)\ntempo <- ekm$time\nst <- ekm$surv\nsummary(ekm)\nplot(ekm, xlab=\"T(semanas)\",ylab=\"S(t)\", lty=2:3)\nlegend(\"topright\",c(\"Rx=0\",\"Rx=1\"), lty = 2:3)\n```\n\n## Modelo Exponencial\n\n```{r}\nleuc.exp.comp <- survreg(Surv(tempo, status) ~ sexo + logwbc + Rx, data = dados, dist = \"exponential\")\nsummary(leuc.exp.comp)\n```\n\n## Automatizando ajuste\n\n```{r}\nlibrary(MASS)\nleuc.exp.sel <- stepAIC(leuc.exp.comp, direction=\"backward\", trace=FALSE)\nsummary(leuc.exp.sel)\n```\n\n## Fazendo Previsões\n\n```{r}\nnovosdados <- data.frame(logwbc=c(2,2), Rx=c(0,1))\npredict(leuc.exp.sel, type=\"lp\", newdata=novosdados)\n```\n\n## Tempo Mediano\n\n```{r}\nprev1 <-predict(leuc.exp.sel, type=\"quantile\", newdata=novosdados, p=0.5)\nprev1\nprev1[1]/prev1[2]\n```\n\n## Comparando com outro quantil\n\n```{r}\nprev2 <-predict(leuc.exp.sel, type=\"quantile\", newdata=novosdados, p=0.7)\nprev2\nprev2[1]/prev2[2]\n```\n\n## Verificando o modelo\n\n```{r}\nlibrary(car)\npar(mfrow = c(1, 2), cex = 0.6)\npred.lin <- predict(leuc.exp.sel, type = \"lp\")[dados$status == 1]\nlog.resid <- log(dados$tempo[dados$status == 1]) - pred.lin\nplot(pred.lin, log.resid, main = \"Grafico TA\",\nxlab = \"log(valores ajustados)\", ylab = \"log(residuos)\")\nqqPlot(exp(log.resid), dist = \"weibull\",\nshape = 1,\nmain = \"Gráfico Q-Q\", xlab = \"Quantis teóricos\", ylab = \"Quantis Empíricos\")\n\n```\n\n## Modelo Weibull\n\n```{r}\nleuc.wei.comp <- survreg(Surv(tempo, status) ~ sexo + logwbc + Rx, data = dados, dist = \"weibull\")\nsummary(leuc.wei.comp)\n```\n\n```{r}\nleuc.wei.sel <- stepAIC(leuc.wei.comp, direction=\"backward\", trace=FALSE)\nsummary(leuc.wei.sel)\n```\n\n## Fazendo Previsões\n\n```{r}\nnovosdados <- data.frame(logwbc=c(2,2), Rx=c(0,1))\npredict(leuc.wei.sel, type=\"lp\", newdata=novosdados)\n```\n\n## Tempo Mediano\n\n```{r}\nprev1 <-predict(leuc.wei.sel, type=\"quantile\", newdata=novosdados, p=0.5)\nprev1\nprev1[1]/prev1[2]\n```\n\n## Comparando com outro quantil\n\n```{r}\nprev2 <-predict(leuc.wei.sel, type=\"quantile\", newdata=novosdados, p=0.7)\nprev2\nprev2[1]/prev2[2]\n```\n\n## Verificando o modelo\n\n```{r}\npar(mfrow = c(1, 2), cex = 0.6)\npred.lin <- predict(leuc.wei.sel, type = \"lp\")[dados$status == 1]\nlog.resid <- log(dados$tempo[dados$status == 1]) - pred.lin\nplot(pred.lin, log.resid, main = \"Grafico TA\",\nxlab = \"log(valores ajustados)\", ylab = \"log(residuos)\")\nqqPlot(exp(log.resid), dist = \"weibull\",\nshape = 1/leuc.wei.sel$scale,\nmain = \"Gráfico Q-Q\", xlab = \"Quantis teóricos\", ylab = \"Quantis Empíricos\")\n\n```\n\n## Modelo Lognormal\n\n```{r}\nleuc.logn.comp <- survreg(Surv(tempo, status) ~ sexo + logwbc + Rx, data = dados, dist = \"lognormal\")\nsummary(leuc.logn.comp)\n```\n\n```{r}\nleuc.logn.sel <- stepAIC(leuc.logn.comp, direction=\"backward\", trace=FALSE)\nsummary(leuc.logn.sel)\n```\n\n## Fazendo Previsões\n\n```{r}\nnovosdados <- data.frame(logwbc=c(2,2), Rx=c(0,1))\npredict(leuc.logn.sel, type=\"lp\", newdata=novosdados)\n```\n\n## Tempo Mediano\n\n```{r}\nprev1 <-predict(leuc.logn.sel, type=\"quantile\", newdata=novosdados, p=0.5)\nprev1\nprev1[1]/prev1[2]\n```\n\n## Comparando com outro quantil\n\n```{r}\nprev2 <-predict(leuc.logn.sel, type=\"quantile\", newdata=novosdados, p=0.7)\nprev2\nprev2[1]/prev2[2]\n```\n\n## Verificando o modelo\n\n```{r}\npar(mfrow = c(1, 2), cex = 0.6)\npred.lin <- predict(leuc.logn.sel, type = \"lp\")[dados$status == 1]\nlog.resid <- log(dados$tempo[dados$status == 1]) - pred.lin\nplot(pred.lin, log.resid, main = \"Grafico TA\",\nxlab = \"log(valores ajustados)\", ylab = \"log(residuos)\")\nqqPlot(exp(log.resid), dist = \"norm\",\nsd = leuc.logn.sel$scale,\nmain = \"Gráfico Q-Q\", xlab = \"Quantis teóricos\", ylab = \"Quantis Empíricos\")\n\n```\n\n## Modelo Loglogistico\n\n```{r}\nleuc.logl.comp <- survreg(Surv(tempo, status) ~ sexo + logwbc + Rx, data = dados, dist = \"loglogistic\")\nsummary(leuc.logl.comp)\n```\n\n```{r}\nleuc.logl.sel <- stepAIC(leuc.logl.comp, direction=\"backward\", trace=FALSE)\nsummary(leuc.logl.sel)\n```\n\n## Fazendo Previsões\n\n```{r}\nnovosdados <- data.frame(logwbc=c(2,2), Rx=c(0,1))\npredict(leuc.logl.sel, type=\"lp\", newdata=novosdados)\n```\n\n## Tempo Mediano\n\n```{r}\nprev1 <-predict(leuc.logl.sel, type=\"quantile\", newdata=novosdados, p=0.5)\nprev1\nprev1[1]/prev1[2]\n```\n\n## Comparando com outro quantil\n\n```{r}\nprev2 <-predict(leuc.logl.sel, type=\"quantile\", newdata=novosdados, p=0.7)\nprev2\nprev2[1]/prev2[2]\n```\n\n## Verificando o modelo\n\n```{r}\npar(mfrow = c(1, 2), cex = 0.6)\npred.lin <- predict(leuc.logl.sel, type = \"lp\")[dados$status == 1]\nlog.resid <- log(dados$tempo[dados$status == 1]) - pred.lin\nplot(pred.lin, log.resid, main = \"Grafico TA\",\nxlab = \"log(valores ajustados)\", ylab = \"log(residuos)\")\nqqPlot(exp(log.resid), dist = \"logis\",\nscale = leuc.logl.sel$scale,\nmain = \"Gráfico Q-Q\", xlab = \"Quantis teóricos\", ylab = \"Quantis Empíricos\")\n\n```\n\n## Comparação dos modelos\n\n```{r}\ntab.exp <- summary(leuc.exp.sel)\ntab.exp\ntab.wei <- summary(leuc.wei.sel)\ntab.wei\nTRV <- 2*(tab.wei$loglik[1] - tab.exp$loglik[1])\npchisq(TRV, 1, lower.tail = F)\ntab.ln <- summary(leuc.logn.sel)\ntab.ln\ntab.ll <- summary(leuc.logl.sel)\ntab.ll\naic.exp <- -2*tab.exp$loglik[1] + 2*3\naic.exp\naic.wei <- -2*tab.wei$loglik[1] + 2*4\naic.wei\naic.ln <- -2*tab.ln$loglik[1] + 2*4\naic.ln\naic.ll <- -2*tab.ll$loglik[1] + 2*4\naic.ll\naic <- c(aic.exp, aic.wei, aic.ln, aic.ll)\ndelta.aic <- aic - min(aic)\ndelta.aic\npeso.aic <- exp(-0.5*delta.aic)/sum(exp(-0.5*delta.aic))\nsum(peso.aic)\nmodelos <- data.frame(modelos=c(\"Exponencial\", \"Weibull\",\n                                \"Lognormal\", \"Loglogistico\"),\n                      p_Akaike = peso.aic)\ngt::gt(modelos)\n\n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"modregpar01.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.0.37","editor":"visual","theme":"cosmo","title":"Análise de Sobrevivência","subtitle":"Modelos de regressão paramétricos","author":"Ricardo Accioly"},"extensions":{"book":{"multiFile":true}}}}}