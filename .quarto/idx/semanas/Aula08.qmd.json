{"title":"Análise de Sobrevivência","markdown":{"yaml":{"title":"Análise de Sobrevivência","subtitle":"Modelos semi-paramétrico de Cox","author":"Ricardo Accioly","format":"html"},"headingText":"Introdução","containsRefs":false,"markdown":"\n\n\nNesta etapa vamos começar a trabalhar com o modelo semi-paramétrico de Cox\n\nO conjunto de dados a seguir chamado \"anderson.xlsx\" consiste em tempos de remissão (em semanas) em 42 pacientes com leucemia, metade dos quais recebem uma certa nova terapia de tratamento e a outra metade recebe uma terapia de tratamento padrão. A variável de exposição de interesse é o tratamento (Rx = 0 se novo tratamento, Rx = 1 se tratamento padrão).\n\nDuas outras variáveis para controle como potenciais confundidores são a contagem de glóbulos brancos (ou seja, logwbc) e sexo. O status de falha é definido pela variável recaída (0 se censurado, 1 se falhar).\n\n## Carregando os dados\n\n```{r ex_1}\nlibrary(survival)\nlibrary(readxl)\ndados <- read_xlsx(\"anderson.xlsx\", col_names = TRUE )\nsummary(dados)\n\n```\n\n## Ajuste Não Paramétrico\n\n```{r ex_2}\nekm <- survfit(Surv(tempo,status)~Rx, data=dados)\ntempo <- ekm$time\nst <- ekm$surv\nsummary(ekm)\nplot(ekm, xlab=\"T(semanas)\",ylab=\"S(t)\", lty=2:3)\nlegend(\"topright\",c(\"Rx=0\",\"Rx=1\"), lty = 2:3)\n```\n\n## Modelo Semi-paramétrico de Cox\n\n```{r}\nleuc.cox1 <- coxph(Surv(tempo, status) ~ sexo + logwbc + Rx, data = dados)\nsummary(leuc.cox1)\n```\n\n## Automatizando ajuste\n\n```{r}\nlibrary(MASS)\nleuc.cox2 <- stepAIC(leuc.cox1, direction=\"backward\", trace=FALSE)\nsummary(leuc.cox2)\n```\n\n## Informações do Ajuste\n\n```{r}\ncoef(leuc.cox2)\nlogLik(leuc.cox2)\n```\n\n## Avaliando o ajuste 1\n\n```{r, message=FALSE}\nlibrary(rms)\nsurvplot(npsurv(Surv(tempo, status) ~ Rx, data = dados),\nloglog = TRUE, logt=TRUE, xlab = \"Tempo\", ylab = \"log(-log(S))\")\n\n```\n\n## Avaliando o ajuste 2\n\n```{r, message=FALSE}\nlibrary(survminer)\nponto <- surv_cutpoint(dados, time = \"tempo\", event = \"status\", variables = \"logwbc\")\nponto$cutpoint[1]\ndados$grupolwbc <- cut(dados$logwbc,ponto$cutpoint[1])\nsurvplot(npsurv(Surv(tempo, status) ~ grupolwbc, data = dados),\nloglog = TRUE, logt=TRUE, xlab = \"Tempo\", ylab = \"log(-log(S))\")\n\n```\n\n## Avaliando o ajuste 3\n\n```{r}\nsmoothSEcurve <- function(yy, xx) {\n# usar depois de chamr um grafico\n# Ajusta um curva lowess curve com IC de 95%\nxx.list <- min(xx) + ((0:100)/100)*(max(xx) - min(xx))\n# Then fit loess function through the points (xx, yy)\n# at the listed values\nyy.xx <- predict(loess(yy ~ xx), se=T,\nnewdata=data.frame(xx=xx.list))\nlines(yy.xx$fit ~ xx.list, lwd=2)\nlines(yy.xx$fit -\nqt(0.975, yy.xx$df)*yy.xx$se.fit ~ xx.list, lty=2)\nlines(yy.xx$fit +\nqt(0.975, yy.xx$df)*yy.xx$se.fit ~ xx.list, lty=2)\n}\nrr.final <- residuals(leuc.cox2 , type=\"martingale\")\nplot(rr.final ~ dados$logwbc)\nsmoothSEcurve(rr.final, dados$logwbc)\ntitle(\"Residuos Martingale \\nversus logwbc\")\nplot(rr.final ~ factor(dados$Rx))\ntitle(\"Residuos Martingale \\nversus Rx\")\n```\n\n## Avaliando o ajuste 4\n\n```{r}\nrr.final2 <- residuals(leuc.cox2 , type=\"deviance\")\nplot(dados$logwbc, rr.final2, xlab=\"logwbc\", ylab = \"Influencia para logwbc\")\nsmoothSEcurve(rr.final2, dados$logwbc)\n# rr.final2 <- residuals(leuc.cox2 , type=\"dfbeta\")\n# plot(dados$logwbc, rr.final2[,1], xlab=\"logwbc\", ylab = \"Influencia para logwbc\")\n```\n\n## Curva de Sobrevivência\n\n```{r}\namostra <- data.frame(\nRx = c(0, 1), logwbc = rep(mean(dados$logwbc), 2))\namostra.surv <- survfit(leuc.cox2, newdata = amostra)\nplot(amostra.surv, col = c(1, 2), conf.int = TRUE,\nxlab = \"Tempo\", ylab = \"S(t)\")\nlegend(\"bottomleft\", bty = \"n\", lty = 1, col = 1:2,\nlegend = sprintf(\"Rx %d\", 0:1))\n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"Aula08.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.269","editor":"visual","theme":{"light":["cosmo","../theme.scss"],"dark":["cosmo","../theme-dark.scss"]},"mainfont":"Atkinson Hyperlegible","code-copy":true,"title":"Análise de Sobrevivência","subtitle":"Modelos semi-paramétrico de Cox","author":"Ricardo Accioly"},"extensions":{"book":{"multiFile":true}}}}}