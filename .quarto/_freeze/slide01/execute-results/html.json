{
  "hash": "d73d752b3431a405115aa4be2842ccc4",
  "result": {
    "markdown": "---\ntitle: \"Análise de Sobrevivência\"\nsubtitle: \"Modelos não Paramétricos\"\nauthor: \"Ricardo Accioly\"\nformat: html\n---\n\n\n### Introdução\n\nNesta apresentação vamos ver passo a passo como obter uma estimativa da curva de sobrevivência através do método de Kaplan-Meier.\n\nVamos inicialmente utilizar o pacote `survival` que é a principal referência em modelos de análise de sobrevivência.\n\nVamos usar neste exemplo dados de pacientes com leucemia. O objetivo é verificar se o tratamento proposto, 6MP, tem efeito sobre a doença. Existem dois grupos de pacientes. 21 receberam 6MP que é um medicamento para tratar leucemia e os outros 21 receberam placebo. O evento falha aqui é ocorrer uma recaída na doença.\n\n### Carregando os dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n✔ ggplot2 3.3.6     ✔ purrr   0.3.4\n✔ tibble  3.1.7     ✔ dplyr   1.0.9\n✔ tidyr   1.2.0     ✔ stringr 1.4.0\n✔ readr   2.1.2     ✔ forcats 0.5.1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(survival)\ntempo<- c(6,6,6,6,7,9,10,10,11,13,16,17,19,20,22,23,25,32,32,34,35)\nstatus<- c(1,1,1,0,1,0,1,0,0,1,1,0,0,0,1,1,0,0,0,0,0)\ndados <- data.frame(tempos=tempo, status=status)\najusteKM <- survfit(Surv(tempos, status) ~ 1, data=dados)\nplot(ajusteKM, xlab=\"Tempo (semanas)\",ylab=\"S(t)\", lty=2) \nlegend(\"topright\",\"6-MP\", lty = 2)\n```\n\n::: {.cell-output-display}\n![](slide01_files/figure-html/ex_1-1.png){width=672}\n:::\n:::\n\n\n### Sumário do ajuste\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(ajusteKM)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall: survfit(formula = Surv(tempos, status) ~ 1, data = dados)\n\n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    6     21       3    0.857  0.0764        0.720        1.000\n    7     17       1    0.807  0.0869        0.653        0.996\n   10     15       1    0.753  0.0963        0.586        0.968\n   13     12       1    0.690  0.1068        0.510        0.935\n   16     11       1    0.627  0.1141        0.439        0.896\n   22      7       1    0.538  0.1282        0.337        0.858\n   23      6       1    0.448  0.1346        0.249        0.807\n```\n:::\n:::\n\n\n### Segundo conjunto de dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntempo2<- c(1,1,2,2,3,4,4,5,5,8,8,8,8,11,11,12,12,15,17,22,23)\nstatus2<- c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1) \ndados2 <- data.frame(tempos=tempo2, status=status2)\najusteKM2 <- survfit(Surv(tempos, status) ~ 1, data=dados2)\nplot(ajusteKM2, xlab=\"t(semanas)\",ylab=\"S(t)\", lty=3) \nlegend(\"topright\",\"Placebo\", lty = 3)\n```\n\n::: {.cell-output-display}\n![](slide01_files/figure-html/ex_3-1.png){width=672}\n:::\n:::\n\n\n### Sumário do 2° ajuste\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(ajusteKM2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall: survfit(formula = Surv(tempos, status) ~ 1, data = dados2)\n\n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    1     21       2   0.9048  0.0641      0.78754        1.000\n    2     19       2   0.8095  0.0857      0.65785        0.996\n    3     17       1   0.7619  0.0929      0.59988        0.968\n    4     16       2   0.6667  0.1029      0.49268        0.902\n    5     14       2   0.5714  0.1080      0.39455        0.828\n    8     12       4   0.3810  0.1060      0.22085        0.657\n   11      8       2   0.2857  0.0986      0.14529        0.562\n   12      6       2   0.1905  0.0857      0.07887        0.460\n   15      4       1   0.1429  0.0764      0.05011        0.407\n   17      3       1   0.0952  0.0641      0.02549        0.356\n   22      2       1   0.0476  0.0465      0.00703        0.322\n   23      1       1   0.0000     NaN           NA           NA\n```\n:::\n:::\n\n\n### Análise conjunta\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntempo2g <- c(tempo,tempo2)\nstatus2g <- c(status,status2)\ngrupos <- c(rep(1,21),rep(2,21))\ndados3 <- data.frame(tempos=tempo2g, status=status2g, grupos=grupos)\najusteKM3 <- survfit(Surv(tempos, status) ~ grupos, data=dados3)\nplot(ajusteKM3, xlab=\"T(semanas)\",ylab=\"S(t)\", lty=1:2, \n     col=c(1,4), conf.int=0.95) \nlegend(\"topright\",c(\"6-MP\",\"Placebo\"), lty = 1:2, col=c(1,4))\n```\n\n::: {.cell-output-display}\n![](slide01_files/figure-html/ex_5-1.png){width=672}\n:::\n:::\n\n\n### Sumário do ajuste\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(ajusteKM3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall: survfit(formula = Surv(tempos, status) ~ grupos, data = dados3)\n\n                grupos=1 \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    6     21       3    0.857  0.0764        0.720        1.000\n    7     17       1    0.807  0.0869        0.653        0.996\n   10     15       1    0.753  0.0963        0.586        0.968\n   13     12       1    0.690  0.1068        0.510        0.935\n   16     11       1    0.627  0.1141        0.439        0.896\n   22      7       1    0.538  0.1282        0.337        0.858\n   23      6       1    0.448  0.1346        0.249        0.807\n\n                grupos=2 \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    1     21       2   0.9048  0.0641      0.78754        1.000\n    2     19       2   0.8095  0.0857      0.65785        0.996\n    3     17       1   0.7619  0.0929      0.59988        0.968\n    4     16       2   0.6667  0.1029      0.49268        0.902\n    5     14       2   0.5714  0.1080      0.39455        0.828\n    8     12       4   0.3810  0.1060      0.22085        0.657\n   11      8       2   0.2857  0.0986      0.14529        0.562\n   12      6       2   0.1905  0.0857      0.07887        0.460\n   15      4       1   0.1429  0.0764      0.05011        0.407\n   17      3       1   0.0952  0.0641      0.02549        0.356\n   22      2       1   0.0476  0.0465      0.00703        0.322\n   23      1       1   0.0000     NaN           NA           NA\n```\n:::\n:::\n\n\n### Intervalos de Confiança - Normal\n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM4 <- survfit(Surv(tempos, status) ~ grupos, data=dados3,\n                     conf.type=\"plain\")\n# IC Pleno (Aproximação pela Normal)\nsummary(ajusteKM4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall: survfit(formula = Surv(tempos, status) ~ grupos, data = dados3, \n    conf.type = \"plain\")\n\n                grupos=1 \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    6     21       3    0.857  0.0764        0.707        1.000\n    7     17       1    0.807  0.0869        0.636        0.977\n   10     15       1    0.753  0.0963        0.564        0.942\n   13     12       1    0.690  0.1068        0.481        0.900\n   16     11       1    0.627  0.1141        0.404        0.851\n   22      7       1    0.538  0.1282        0.286        0.789\n   23      6       1    0.448  0.1346        0.184        0.712\n\n                grupos=2 \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    1     21       2   0.9048  0.0641       0.7792        1.000\n    2     19       2   0.8095  0.0857       0.6416        0.977\n    3     17       1   0.7619  0.0929       0.5797        0.944\n    4     16       2   0.6667  0.1029       0.4650        0.868\n    5     14       2   0.5714  0.1080       0.3598        0.783\n    8     12       4   0.3810  0.1060       0.1733        0.589\n   11      8       2   0.2857  0.0986       0.0925        0.479\n   12      6       2   0.1905  0.0857       0.0225        0.358\n   15      4       1   0.1429  0.0764       0.0000        0.293\n   17      3       1   0.0952  0.0641       0.0000        0.221\n   22      2       1   0.0476  0.0465       0.0000        0.139\n   23      1       1   0.0000     NaN          NaN          NaN\n```\n:::\n:::\n\n\n### Intervalos de Confiança - Log\n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM5 <- survfit(Surv(tempos, status) ~ grupos, data=dados3,\n                     conf.type=\"log\")\n# IC log - Padrão do R\nsummary(ajusteKM5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall: survfit(formula = Surv(tempos, status) ~ grupos, data = dados3, \n    conf.type = \"log\")\n\n                grupos=1 \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    6     21       3    0.857  0.0764        0.720        1.000\n    7     17       1    0.807  0.0869        0.653        0.996\n   10     15       1    0.753  0.0963        0.586        0.968\n   13     12       1    0.690  0.1068        0.510        0.935\n   16     11       1    0.627  0.1141        0.439        0.896\n   22      7       1    0.538  0.1282        0.337        0.858\n   23      6       1    0.448  0.1346        0.249        0.807\n\n                grupos=2 \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    1     21       2   0.9048  0.0641      0.78754        1.000\n    2     19       2   0.8095  0.0857      0.65785        0.996\n    3     17       1   0.7619  0.0929      0.59988        0.968\n    4     16       2   0.6667  0.1029      0.49268        0.902\n    5     14       2   0.5714  0.1080      0.39455        0.828\n    8     12       4   0.3810  0.1060      0.22085        0.657\n   11      8       2   0.2857  0.0986      0.14529        0.562\n   12      6       2   0.1905  0.0857      0.07887        0.460\n   15      4       1   0.1429  0.0764      0.05011        0.407\n   17      3       1   0.0952  0.0641      0.02549        0.356\n   22      2       1   0.0476  0.0465      0.00703        0.322\n   23      1       1   0.0000     NaN           NA           NA\n```\n:::\n:::\n\n\n### Intervalos de Confiança - Log-Log\n\n\n\n\n\n### Usando o pacote survminer\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survminer)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nCarregando pacotes exigidos: ggpubr\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'survminer'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:survival':\n\n    myeloma\n```\n:::\n\n```{.r .cell-code}\ndados <- data.frame(tempo=tempo2g, status=status2g, grupo= grupos)\najusteKM4 <- survfit(Surv(tempo2g, status2g) ~ grupo, data= dados, conf.type=\"log-log\")\nggsurvplot(ajusteKM4, data=dados)\n```\n\n::: {.cell-output-display}\n![](slide01_files/figure-html/ex_10-1.png){width=672}\n:::\n:::\n\n\n### Melhorando a visualização\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados <- data.frame(tempo=tempo2g, status=status2g, grupo= grupos)\nfit4 <- survfit(Surv(tempo2g, status2g) ~ grupo, data= dados, conf.type=\"log-log\")\nggsurvplot(\n  fit4,                   \n  data = dados,           \n  risk.table = TRUE,      \n  pval = FALSE,           \n  conf.int = TRUE,        \n  xlim = c(0,40),         \n  xlab = \"Tempo em meses\",  \n  ylab = \"S(t)\",\n  break.time.by = 10,     \n  ggtheme = theme_light(), \n  risk.table.y.text.col = T, \n  risk.table.y.text = FALSE  \n)\n```\n\n::: {.cell-output-display}\n![](slide01_files/figure-html/ex_11-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "slide01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}