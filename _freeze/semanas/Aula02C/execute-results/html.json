{
  "hash": "830e2777c9db11e622b6a7a485d08cae",
  "result": {
    "markdown": "---\ntitle: \"Análise de Sobrevivência\"\nsubtitle: \"Modelos não Paramétricos\"\nauthor: \"Prof. Ricardo Accioly\"\nformat:\n html:\n    code-link: true\n    fig-width: 9\n    fig-height: 7\n    fig-dpi: 300\nknitr:\n  opts_chunk: \n    out.width: 90%\n    comment: \"#>\"\n---\n\n\n## Análise de Sobrevivência\n\nNesta apresentação vamos ver passo a passo como obter uma estimativa da curva de sobrevivência através do método de Kaplan-Meier.\n\nVamos inicialmente utilizar o pacote `survival` que é a principal referência em modelos de análise de sobrevivência.\n\nVamos usar neste exemplo dados de pacientes com leucemia.\n\nO objetivo é verificar se o tratamento proposto, 6MP, tem efeito sobre a doença.\n\nExistem dois grupos de pacientes:\n\n-   21 receberam 6MP que é um medicamento para tratar leucemia\n-   Os outros 21 receberam placebo.\n\n::: {.fragment .highlight-red}\nO evento falha aqui é ocorrer uma recaída na doença.\n:::\n\n## Função taxa de falhas e quantis\n\nVamos obter uma aproximação da função taxa de falhas usando a função density\n\nPosteriormente vamos obter o quantil usando uma função do pacote `survey`\n\n## Taxa de falhas h(t) não paramétrica - 6MP \n\n::: panel-tabset\n### Codigo\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survival)\nlibrary(readxl)\ndados <- read_xlsx(\"anderson.xlsx\", col_names = TRUE)\najusteKM <- survfit(Surv(tempo, status) ~ 1, subset = (Rx==0), data=dados)\najusteKM_sum <- summary(ajusteKM)\npesos <- ajusteKM_sum$n.event/ajusteKM_sum$n.risk\nh <- density(ajusteKM_sum$time, kernel = \"epanechnikov\", n = 100, from = 0, to = 35, weights = pesos)\nlibrary(ggplot2)\ndata <- data.frame(x=h$x, y=h$y)\n```\n:::\n\n\n### Grafico\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data, aes(x=x, y=y)) + geom_line() + scale_y_continuous(limits=c(0,0.20)) + theme_light() +\n  theme(axis.text = element_text(size = 12),\n        axis.title = element_text(size = 14)) +\n  labs(x = \"Tempo [semanas]\", y = \"Estimativa da taxa de falhas\", title = \"Estimativa da taxa de falhas - 6MP\")\n```\n\n::: {.cell-output-display}\n![](Aula02C_files/figure-html/unnamed-chunk-2-1.png){width=90%}\n:::\n:::\n\n:::\n\n## Taxa de falhas h(t) não paramétrica - Placebo\n\n::: panel-tabset\n### Codigo\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntempo2<- c(1,1,2,2,3,4,4,5,5,8,8,8,8,11,11,12,12,15,17,22,23)\nstatus2<- c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1) \ndados <- data.frame(tempos=tempo2, status=status2)\najusteKM <- survfit(Surv(tempos, status) ~ 1, data=dados)\najusteKM_sum <- summary(ajusteKM)\npesos <- ajusteKM_sum$n.event/ajusteKM_sum$n.risk\nh <- density(ajusteKM_sum$time, weights = pesos,\nkernel = \"epanechnikov\", n = 100, from = 0, to = 25)\ndata <- data.frame(x=h$x, y=h$y)\n```\n:::\n\n\n### Grafico\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data, aes(x=x, y=y)) + geom_line() + scale_y_continuous(limits=c(0,0.20)) +  theme_light() +\n  theme(axis.text = element_text(size = 12),\n        axis.title = element_text(size = 14)) +\n  labs(x = \"Tempo [semanas]\", y = \"Estimativa da taxa de falhas\", title = \"Estimativa da taxa de falhas - Placebo\")\n```\n\n::: {.cell-output-display}\n![](Aula02C_files/figure-html/unnamed-chunk-4-1.png){width=90%}\n:::\n:::\n\n:::\n\n## Quantis não paramétricos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survey)\ndados_p <- svydesign(ids = ~1, data=dados)\ndados_svykm <- svykm(Surv(tempos, status) ~ 1, dados_p, se=TRUE)\nquantile(dados_svykm, 0.5, ci=TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> 0.5 \n#>   8 \n#> attr(,\"ci\")\n#>     0.025 0.975\n#> 0.5     5    12\n```\n:::\n:::\n",
    "supporting": [
      "Aula02C_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}