{
  "hash": "a1f29bc3737ea2decce7f9d03b9dfe62",
  "result": {
    "markdown": "---\ntitle: \"Análise de Sobrevivência\"\nsubtitle: \"Modelos Paramétricos - Avaliação do ajuste\"\nauthor: \"Ricardo Accioly\"\nformat:\n html:\n    code-link: true\n    fig-width: 9\n    fig-height: 7\n    fig-dpi: 300\nknitr:\n  opts_chunk: \n    out.width: 90%\n    comment: \"#>\"\n---\n\n\n## Modelos Paramétricos\n\nNeste exemplo são considerados os tempos de reincidência, em meses, de um grupo de 20 pacientes com cancer de bexiga que foram submetidos a um procedimento cirurgico feito por laser.\n\nVamos ver passo a passo como ajustar os modelos exponencial, Weibull e lognormal.\n\nAqui vamos utilizar as funções existentes no pacote `survival`.\n\nPara ajustar um modelo paramétrico usamo a função `survreg`.\n\n## Metodo de Kaplan-Meier\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survival)\ntempos<-c(3,5,6,7,8,9,10,10,12,15,15,18,19,20,22,25,28,30,40,45)\ncens<-c(1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0)\ndados <- data.frame(tempos=tempos, status=cens)\nekm <- survfit(Surv(tempos,status)~1, data=dados)\nsummary(ekm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call: survfit(formula = Surv(tempos, status) ~ 1, data = dados)\n#> \n#>  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#>     3     20       1   0.9500  0.0487      0.85913        1.000\n#>     5     19       1   0.9000  0.0671      0.77767        1.000\n#>     6     18       1   0.8500  0.0798      0.70707        1.000\n#>     7     17       1   0.8000  0.0894      0.64257        0.996\n#>     8     16       1   0.7500  0.0968      0.58233        0.966\n#>     9     15       1   0.7000  0.1025      0.52541        0.933\n#>    10     14       1   0.6500  0.1067      0.47124        0.897\n#>    12     12       1   0.5958  0.1107      0.41402        0.857\n#>    15     11       1   0.5417  0.1131      0.35976        0.816\n#>    18      9       1   0.4815  0.1154      0.30096        0.770\n#>    19      8       1   0.4213  0.1156      0.24601        0.721\n#>    20      7       1   0.3611  0.1137      0.19481        0.669\n#>    22      6       1   0.3009  0.1095      0.14745        0.614\n#>    25      5       1   0.2407  0.1028      0.10422        0.556\n#>    28      4       1   0.1806  0.0931      0.06573        0.496\n#>    30      3       1   0.1204  0.0792      0.03317        0.437\n#>    40      2       1   0.0602  0.0581      0.00907        0.399\n```\n:::\n:::\n\n\n## Curva de Sobrevivência não paramétrica\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(ekm, xlab=\"Tempo (meses)\",ylab=\"S(t) estimada\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-2-1.png){width=90%}\n:::\n:::\n\n\n## Taxa de Falhas não paramétrica\n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM <- survfit(Surv(tempos, status) ~ 1, data=dados)\najusteKM_sum <- summary(ajusteKM)\npesos <- ajusteKM_sum$n.event/ajusteKM_sum$n.risk\nh <- density(ajusteKM_sum$time, weights = pesos, \n             kernel = \"gaussian\", n = 100, from = 0, to = 45)\nplot(h$x, h$y, type = \"l\", xlab = \"Tempo (meses)\", ylab = \"Taxa de Falhas\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-3-1.png){width=90%}\n:::\n:::\n\n\n## Quantis não parametricos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survey)\ndados_p <- svydesign(ids = ~1, data=dados)\ndados_svykm <- svykm(Surv(tempos, status) ~ 1, dados_p, se=TRUE)\nmediana.km <- quantile(dados_svykm, 0.5, ci=TRUE)\nmed.km <- c(mediana.km[1], attr(mediana.km, \"ci\")[1], attr(mediana.km, \"ci\")[2])\nnames(med.km) <- c(\"mediana KM\",\"ICI\",\"ICS\")\nmed.km\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> mediana KM        ICI        ICS \n#>         18         10         28\n```\n:::\n:::\n\n\n## Modelo Exponencial\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustExp <- survreg(Surv(tempos,status)~1, \n                    data=dados, dist='exponential')\najustExp\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> survreg(formula = Surv(tempos, status) ~ 1, data = dados, dist = \"exponential\")\n#> \n#> Coefficients:\n#> (Intercept) \n#>    3.016111 \n#> \n#> Scale fixed at 1 \n#> \n#> Loglik(model)= -68.3   Loglik(intercept only)= -68.3\n#> n= 20\n```\n:::\n\n```{.r .cell-code}\nalfa <- exp(ajustExp$coefficients[1])\nalfa\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> (Intercept) \n#>    20.41176\n```\n:::\n:::\n\n\n## Taxa de falhas NP vs Exp\n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM <- survfit(Surv(tempos, status) ~ 1, data=dados)\najusteKM_sum <- summary(ajusteKM)\npesos <- ajusteKM_sum$n.event/ajusteKM_sum$n.risk\nh <- density(ajusteKM_sum$time, weights = pesos, \n             kernel = \"gaussian\", n = 100, from = 0, to = 45)\nplot(h$x, h$y, type = \"l\", xlab = \"Tempo (meses)\", ylab = \"Taxa de Falhas\")\nexpHaz <- function(x, rate) { \n  dexp(x, rate=rate)/\n    pexp(x, rate=rate, lower.tail=F)\n}\ncurve(expHaz(x, rate=1/alfa), from=0, to=45,\n      ylab=\"h(t)\", xlab=\"Tempo\", \n      col=\"red\", ylim=c(0,1),\n      add=TRUE)\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-6-1.png){width=90%}\n:::\n:::\n\n\n## Quantis do Modelo Exponencial\n\n::: panel-tabset\n### Cálculos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nest_med <- predict(ajustExp,type=\"uquantile\",p=0.5,se.fit=T)\nest_med1 <- est_med$fit[1]\nest_med1.ep <- est_med$se.fit[1]\n\nIC.mediana_exp <- c(exp(est_med1),exp(est_med1-1.96*est_med1.ep),\nexp(est_med1+1.96*est_med1.ep))\nnames(IC.mediana_exp) <- c(\"mediana Exp\",\"ICI\",\"ICS\")\n```\n:::\n\n\n### Resultados\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#IC Mediana\nIC.mediana_exp\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> mediana Exp         ICI         ICS \n#>   14.148357    8.795399   22.759175\n```\n:::\n:::\n\n:::\n\n## Avaliação do modelo Exponencial\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(car)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Carregando pacotes exigidos: carData\n```\n:::\n\n```{.r .cell-code}\nn.censurado <- dados$tempos[dados$status == 1]\nqqPlot(n.censurado,\ndist = \"exp\",\nrate = 1/alfa,\nxlab = \"Quantis Teoricos (exponencial)\",\nylab = \"Quantis Empiricos\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-9-1.png){width=90%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 17 16\n```\n:::\n:::\n\n\n## Modelo Weibull\n\n::: panel-tabset\n### Ajuste do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustWei <- survreg(Surv(tempos,status)~1, data=dados, dist='weibull')\najustWei\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> survreg(formula = Surv(tempos, status) ~ 1, data = dados, dist = \"weibull\")\n#> \n#> Coefficients:\n#> (Intercept) \n#>    3.060529 \n#> \n#> Scale= 0.647922 \n#> \n#> Loglik(model)= -66.1   Loglik(intercept only)= -66.1\n#> n= 20\n```\n:::\n\n```{.r .cell-code}\nalfaw <- exp(ajustWei$coefficients[1])\nbetaw <- 1/ajustWei$scale\n```\n:::\n\n\n### Parametros do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Alfa - parametro de escala\nalfaw\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> (Intercept) \n#>    21.33885\n```\n:::\n\n```{.r .cell-code}\n# Beta - parametro de forma\nbetaw\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 1.543396\n```\n:::\n:::\n\n:::\n\n## Taxa de Falhas NP vs Weibull\n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM <- survfit(Surv(tempos, status) ~ 1, data=dados)\najusteKM_sum <- summary(ajusteKM)\npesos <- ajusteKM_sum$n.event/ajusteKM_sum$n.risk\nh <- density(ajusteKM_sum$time, weights = pesos, \n             kernel = \"gaussian\", n = 100, from = 0, to = 45)\nplot(h$x, h$y, type = \"l\", xlab = \"Tempo (meses)\", ylab = \"Taxa de Falhas\",\n     ylim=c(0,0.10))\nweibHaz <- function(x, shape, scale) { \n  dweibull(x, shape=shape, scale=scale)/\n  pweibull(x, shape=shape, scale=scale,\n           lower.tail=F)\n}\ncurve(weibHaz(x, shape=betaw, scale=alfaw), \n      from=0, to=45,\n      ylab=\"h(t)\", xlab=\"Tempo\", col=\"red\",\n      add=TRUE)\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-12-1.png){width=90%}\n:::\n:::\n\n\n## Quantis do Modelo Weibull\n\n::: panel-tabset\n### Cálculos\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustWei <- survreg(Surv(tempos,status)~1, data=dados, dist='weibull')\nestmedw <- predict(ajustWei,type=\"uquantile\",p=0.5,se.fit=T)\nestmedw1 <- estmedw$fit[1]\nestmedw1.ep <- estmedw$se.fit[1]\nIC.mediana_w <- c(exp(estmedw1),exp(estmedw1-1.96*estmedw1.ep),\nexp(estmedw1+1.96*estmedw1.ep))\nnames(IC.mediana_w) <- c(\"mediana Wei\",\"ICI\",\"ICS\")\n```\n:::\n\n\n### Resultados\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Mediana\nIC.mediana_w\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> mediana Wei         ICI         ICS \n#>    16.82823    11.95670    23.68456\n```\n:::\n:::\n\n:::\n\n## Avaliação do Modelo Weibull\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn.censurado <- dados$tempos[dados$status == 1]\nqqPlot(n.censurado,\ndist = \"weibull\",\nshape = betaw,\nscale = alfaw,\nxlab = \"Quantis Teoricos (Weibull)\",\nylab = \"Quantis Empiricos\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-15-1.png){width=90%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 17 16\n```\n:::\n:::\n\n\n## Modelo Lognormal\n\n::: panel-tabset\n### Ajuste do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustLog <- survreg(Surv(tempos, status)~1, data=dados, dist='lognorm')\najustLog\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> survreg(formula = Surv(tempos, status) ~ 1, data = dados, dist = \"lognorm\")\n#> \n#> Coefficients:\n#> (Intercept) \n#>    2.717176 \n#> \n#> Scale= 0.7648167 \n#> \n#> Loglik(model)= -65.7   Loglik(intercept only)= -65.7\n#> n= 20\n```\n:::\n\n```{.r .cell-code}\nmulog <- ajustLog$icoef[1]\nsigmalog <- ajustLog$scale\n```\n:::\n\n\n### Parametros do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Media\nmulog\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> (Intercept) \n#>    2.717176\n```\n:::\n\n```{.r .cell-code}\n# Desvio padrão\nsigmalog\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.7648167\n```\n:::\n:::\n\n:::\n\n## Taxa de Falhas NP vs Lognormal\n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM <- survfit(Surv(tempos, status) ~ 1, data=dados)\najusteKM_sum <- summary(ajusteKM)\npesos <- ajusteKM_sum$n.event/ajusteKM_sum$n.risk\nh <- density(ajusteKM_sum$time, weights = pesos, \n             kernel = \"gaussian\", n = 100, from = 0, to = 45)\nplot(h$x, h$y, type = \"l\", xlab = \"Tempo (meses)\", ylab = \"Taxa de Falhas\",\n     ylim=c(0,0.10))\nlogHaz <- function(x, meanlog, sdlog) {\n  dlnorm(x, meanlog=meanlog, sdlog=sdlog)/\n  plnorm(x, meanlog=meanlog, sdlog=sdlog, \n         lower.tail=F)\n}\ncurve(logHaz(x, meanlog=mulog, sdlog=sigmalog), from=0, to=45,\n      ylab=\"h(t)\", xlab=\"Tempo\", \n      col=\"red\",\n      add=TRUE)\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-18-1.png){width=90%}\n:::\n:::\n\n\n## Quantis do Modelo Lognormal\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustLog <- survreg(Surv(tempos, status)~1, data=dados, dist='lognorm')\nestmedl <- predict(ajustLog,type=\"uquantile\",p=0.5,se.fit=T)\nestmedl1 <- estmedl$fit[1]\nestmedl1.ep <- estmedl$se.fit[1]\nIC.mediana_log <- c(exp(estmedl1),exp(estmedl1-1.96*estmedl1.ep),\nexp(estmedl1+1.96*estmedl1.ep))\nnames(IC.mediana_log) <- c(\"mediana Logn\",\"ICI\",\"ICS\")\nIC.mediana_log\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> mediana Logn          ICI          ICS \n#>     15.13751     10.71601     21.38334\n```\n:::\n:::\n\n\n## Avaliação do Modelo Lognormal\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn.censurado <- dados$tempos[dados$status == 1]\nqqPlot(n.censurado,\ndist = \"lnorm\",\nmeanlog = mulog,\nsdlog = sigmalog,\nxlab = \"Quantis Teoricos (Lognormal)\",\nylab = \"Quantis Empiricos\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-20-1.png){width=90%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 17 16\n```\n:::\n:::\n\n\n## Modelo Loglogístico\n\n::: panel-tabset\n### Ajuste do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustLLog <- survreg(Surv(tempos, status)~1, data=dados, dist='loglogistic')\najustLLog\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> survreg(formula = Surv(tempos, status) ~ 1, data = dados, dist = \"loglogistic\")\n#> \n#> Coefficients:\n#> (Intercept) \n#>    2.737415 \n#> \n#> Scale= 0.4496653 \n#> \n#> Loglik(model)= -66   Loglik(intercept only)= -66\n#> n= 20\n```\n:::\n\n```{.r .cell-code}\nbetall<- ajustLLog$icoef[1]\nalfall <- ajustLLog$scale\nmullog <- betall\nsigmallog <- alfall\n```\n:::\n\n\n### Parametros do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Media\nbetall\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> (Intercept) \n#>    2.737415\n```\n:::\n\n```{.r .cell-code}\n# Desvio padrão\nalfall\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.4496653\n```\n:::\n:::\n\n:::\n\n## Taxa de Falhas NP vs Loglogística\n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM <- survfit(Surv(tempos, status) ~ 1, data=dados)\najusteKM_sum <- summary(ajusteKM)\npesos <- ajusteKM_sum$n.event/ajusteKM_sum$n.risk\nh <- density(ajusteKM_sum$time, weights = pesos, \n             kernel = \"gaussian\", n = 100, from = 0, to = 45)\nplot(h$x, h$y, type = \"l\", xlab = \"Tempo (meses)\", ylab = \"Taxa de Falhas\",\n     ylim=c(0,0.15))\nlibrary(flexsurv)\nllogisHaz <- function(x, alfa, beta) {\n  haz <- hllogis(x, shape = beta, scale = alfa, log = FALSE)\n}\ncurve(llogisHaz(x, alfa=alfall, beta=betall), from=0, to=45,\n      ylab=\"h(t)\", xlab=\"Tempo\", col=\"red\", add=TRUE)\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-23-1.png){width=90%}\n:::\n:::\n\n\n## Quantis do Modelo Log-Logístico\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustLLog <- survreg(Surv(tempos, status)~1, data=dados, dist='loglogistic')\nestmedll <- predict(ajustLLog,type=\"uquantile\",p=0.5,se.fit=T)\nestmedll1 <- estmedll$fit[1]\nestmedll1.ep <- estmedll$se.fit[1]\nIC.mediana_llog <- c(exp(estmedll1),exp(estmedll1-1.96*estmedll1.ep),\nexp(estmedll1+1.96*estmedll1.ep))\nnames(IC.mediana_llog) <- c(\"mediana LogL\",\"ICI\",\"ICS\")\nIC.mediana_llog\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> mediana LogL          ICI          ICS \n#>     15.44700     10.85399     21.98361\n```\n:::\n:::\n\n\n## Avaliação do Modelo Log-Logístico\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn.censurado <- dados$tempos[dados$status == 1]\nqqPlot(n.censurado,\n       dist = \"llogis\",\n       shape = betall,\n       scale = alfall,\n       xlab = \"Quantis Teoricos (LogLogistico)\",\n       ylab = \"Quantis Empiricos\")\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-25-1.png){width=90%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 17 16\n```\n:::\n:::\n\n\n## Curvas de Sobrevivência dos Modelos\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntempo <- ekm$time\nst <- ekm$surv\nste <- exp(-tempo/alfa)\nstw <- exp(-(tempo/alfaw)^betaw)\nstln <- pnorm((-log(tempo) + mulog)/sigmalog)\nstll <- plogis((-log(tempo) + mullog)/sigmallog)\ncbind(tempo,st,ste,stw,stln, stll)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>       tempo         st       ste        stw       stln      stll\n#>  [1,]     3 0.95000000 0.8633164 0.95274148 0.98283934 0.9745310\n#>  [2,]     5 0.90000000 0.7827384 0.89897484 0.92624322 0.9247343\n#>  [3,]     6 0.85000000 0.7453152 0.86839357 0.88685752 0.8911964\n#>  [4,]     7 0.80000000 0.7096812 0.83609525 0.84337638 0.8532358\n#>  [5,]     8 0.75000000 0.6757509 0.80253272 0.79781416 0.8120295\n#>  [6,]     9 0.70000000 0.6434428 0.76809812 0.75169629 0.7687589\n#>  [7,]    10 0.65000000 0.6126794 0.73313414 0.70611769 0.7245227\n#>  [8,]    12 0.59583333 0.5554947 0.66278292 0.61931883 0.6368104\n#>  [9,]    15 0.54166667 0.4795676 0.55966698 0.50475984 0.5163200\n#> [10,]    18 0.48148148 0.4140186 0.46346069 0.41042396 0.4157713\n#> [11,]    19 0.42129630 0.3942241 0.43345774 0.38317692 0.3868919\n#> [12,]    20 0.36111111 0.3753760 0.40461041 0.35784922 0.3602069\n#> [13,]    22 0.30092593 0.3403401 0.35056108 0.31248031 0.3129370\n#> [14,]    25 0.24074074 0.2938212 0.27891623 0.25592025 0.2552681\n#> [15,]    28 0.18055556 0.2536607 0.21851514 0.21065456 0.2103630\n#> [16,]    30 0.12037037 0.2299851 0.18419003 0.18556452 0.1860066\n#> [17,]    40 0.06018519 0.1409071 0.07154720 0.10195229 0.1075572\n#> [18,]    45 0.06018519 0.1102934 0.04229094 0.07714984 0.0848755\n```\n:::\n:::\n\n\n## Quantis dos Modelos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(med.km) <- c(\"Mediana\", \"ICI\", \"ICS\")\nquantis <- rbind(med.km, IC.mediana_exp, IC.mediana_w, IC.mediana_log, IC.mediana_llog)\nquantis\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>                  Mediana       ICI      ICS\n#> med.km          18.00000 10.000000 28.00000\n#> IC.mediana_exp  14.14836  8.795399 22.75917\n#> IC.mediana_w    16.82823 11.956697 23.68456\n#> IC.mediana_log  15.13751 10.716009 21.38334\n#> IC.mediana_llog 15.44700 10.853987 21.98361\n```\n:::\n:::\n\n\n## Comparação NP vs Paramétrico\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,2))\nplot(st,ste,pch=16,ylim=range(c(0.0,1)), xlim=range(c(0,1)), xlab = \"S(t): Kaplan-Meier\", ylab=\"S(t): exponencial\")\nlines(c(0,1), c(0,1), type=\"l\", lty=1)\nplot(st,stw,pch=16,ylim=range(c(0.0,1)), xlim=range(c(0,1)), xlab = \"S(t): Kaplan-Meier\",\n     ylab=\"S(t): Weibull\")\nlines(c(0,1), c(0,1), type=\"l\", lty=1)\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-28-1.png){width=90%}\n:::\n:::\n\n\n## Comparação NP vs Paramétrico\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,2))\nplot(st,stln,pch=16,ylim=range(c(0.0,1)), xlim=range(c(0,1)), xlab = \"S(t): Kaplan-Meier\",\n     ylab=\"S(t): Log-normal\")\nlines(c(0,1), c(0,1), type=\"l\", lty=1)\nplot(st,stll,pch=16,ylim=range(c(0.0,1)), xlim=range(c(0,1)), xlab = \"S(t): Kaplan-Meier\",\n     ylab=\"S(t): log-Logistica\")\nlines(c(0,1), c(0,1), type=\"l\", lty=1)\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-29-1.png){width=90%}\n:::\n:::\n\n\n## Comparação NP vs Paramétrico\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,2))\nplot(ekm, conf.int=F, xlab=\"Tempos\", ylab=\"S(t)\")\nlines(c(0,tempo),c(1,ste), lty=2)\nlegend(25,0.8,lty=c(1,2),c(\"Kaplan-Meier\", \"Exponencial\"),bty=\"n\",cex=0.8)\nplot(ekm, conf.int=F, xlab=\"Tempos\", ylab=\"S(t)\")\nlines(c(0,tempo),c(1,stw), lty=2)\nlegend(25,0.8,lty=c(1,2),c(\"Kaplan-Meier\", \"Weibull\"),bty=\"n\",cex=0.8)\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-30-1.png){width=90%}\n:::\n:::\n\n\n## Comparação NP vs Paramétrico\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,2))\nplot(ekm, conf.int=F, xlab=\"Tempos\", ylab=\"S(t)\")\nlines(c(0,tempo),c(1,stln), lty=2)\nlegend(25,0.8,lty=c(1,2),c(\"Kaplan-Meier\", \"Lognormal\"),bty=\"n\",cex=0.8)\nplot(ekm, conf.int=F, xlab=\"Tempos\", ylab=\"S(t)\")\nlines(c(0,tempo),c(1,stll), lty=2)\nlegend(25,0.8,lty=c(1,2),c(\"Kaplan-Meier\", \"LogLogistica\"),bty=\"n\",cex=0.8)\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-31-1.png){width=90%}\n:::\n:::\n\n\n## Modelos Paramétricos\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustExp <- survreg(Surv(tempos,status)~1, data=dados, dist='exponential')\nalfa <- exp(ajustExp$coefficients[1])\najustWei <- survreg(Surv(tempos,status)~1, data=dados, dist='weibull')\nalfaw <- exp(ajustWei$coefficients[1])\nbetaw <- 1/ajustWei$scale\najustLog <- survreg(Surv(tempos,status)~1, data=dados, dist='lognorm')\nmu <- ajustLog$icoef[1]\nsigma <- exp(ajustLog$icoef[2])\najustLogl <- survreg(Surv(tempos,status)~1, data=dados, dist='loglogistic')\nmu1 <- ajustLogl$icoef[1]\nsigma1 <- exp(ajustLogl$icoef[2])\n```\n:::\n\n\n## Avaliação do Modelo Weibull\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab.np <- summary(ekm)\nplot(log(-log(tab.np$surv)) ~ log(tab.np$time),\n     xlab=\"log(t)\", ylab=\"log(-log(S(t)))\", pch=20)\nmod1.lm <- lm(log(-log(tab.np$surv)) ~ log(tab.np$time))\nabline(mod1.lm)\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-33-1.png){width=90%}\n:::\n\n```{.r .cell-code}\nconfint(mod1.lm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>                      2.5 %    97.5 %\n#> (Intercept)      -4.763998 -4.318050\n#> log(tab.np$time)  1.442427  1.609615\n```\n:::\n:::\n\n\n## Avaliação do Modelo Lognormal\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab.np <- summary(ekm)\ninvst1 <- qnorm(tab.np$surv)\nplot(invst1 ~ log(tab.np$time),\n     xlab=\"log(t)\", ylab=expression(Phi^-1*(S(t))), pch=20)\nmod2.lm <- lm(invst1 ~ log(tab.np$time))\nabline(mod2.lm)\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-34-1.png){width=90%}\n:::\n:::\n\n\n## Avaliação do Modelo LogLogístico\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab.np <- summary(ekm)\ninvst2 <- qlogis(tab.np$surv) \nplot(invst2 ~ log(tab.np$time),\n     xlab=\"log(t)\", ylab=expression(Phi^-1*Logis*(S(t))), pch=20)\nmod3.lm <- lm(invst2 ~ log(tab.np$time))\nabline(mod3.lm)\n```\n\n::: {.cell-output-display}\n![](Aula04_files/figure-html/unnamed-chunk-35-1.png){width=90%}\n:::\n:::\n\n\n## Teste de Razão de Verossimilhança\n\nNo nível de significância de 𝛼=0,05 eu rejeito a hipótese de que o parametro de forma seja igual a 1.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab.exp <- summary(ajustExp)\ntab.wei <- summary(ajustWei)\nTRV <- 2*(tab.wei$loglik[1] - tab.exp$loglik[1])\npchisq(TRV, 1, lower.tail = F)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.03853913\n```\n:::\n:::\n\n\n## Calculos do peso do AIC\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab.exp <- summary(ajustExp)\ntab.wei <- summary(ajustWei)\ntab.ln <- summary(ajustLog)\ntab.ll <- summary(ajustLogl)\naic.exp <- -2*tab.exp$loglik[1] + 2*1\naic.wei <- -2*tab.wei$loglik[1] + 2*2\naic.ln <- -2*tab.ln$loglik[1] + 2*2\naic.ll <- -2*tab.ll$loglik[1] + 2*2\naic <- c(aic.exp, aic.wei, aic.ln, aic.ll)\ndelta.aic <- aic - min(aic)\npeso.aic <- exp(-0.5*delta.aic)/sum(exp(-0.5*delta.aic))\n# Usando a função AIC para calcuar o AIC\naic.exp1 <- AIC(ajustExp)\naic.wei1 <- AIC(ajustWei)\naic.ln1 <- AIC(ajustLog)\naic.ll1 <- AIC(ajustLogl)\naic1 <- c(aic.exp1, aic.wei1, aic.ln1, aic.ll1)\naic\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 138.5478 136.2667 135.4798 136.0611\n```\n:::\n\n```{.r .cell-code}\naic1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 138.5478 136.2667 135.4798 136.0611\n```\n:::\n:::\n\n\n## Comparando modelos através do Peso de Akaike\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelos <- data.frame(modelos=c(\"Exponencial\", \"Weibull\",\n                                \"Lognormal\", \"Loglogistico\"),\n                      p_Akaike = peso.aic)\nmodelos\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        modelos   p_Akaike\n#> 1  Exponencial 0.08175044\n#> 2      Weibull 0.25575120\n#> 3    Lognormal 0.37904837\n#> 4 Loglogistico 0.28344999\n```\n:::\n:::\n\n\n## Comparando os modelos através do BIC\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbic.exp <- BIC(ajustExp)\nbic.wei <- BIC(ajustWei)\nbic.ln <- BIC(ajustLog)\nbic.ll <- BIC(ajustLogl)\nmodelos <- data.frame(modelos=c(\"Exponencial\", \"Weibull\",\n                                \"Lognormal\", \"Loglogistico\"),\n                      BIC = c(bic.exp, bic.wei, bic.ln, bic.ll))\nmodelos\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        modelos      BIC\n#> 1  Exponencial 139.5435\n#> 2      Weibull 138.2582\n#> 3    Lognormal 137.4713\n#> 4 Loglogistico 138.0525\n```\n:::\n:::\n",
    "supporting": [
      "Aula04_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}