{
  "hash": "2d8a56d97d4da2b11811a4cc2b1622b4",
  "result": {
    "markdown": "---\ntitle: \"Análise de Sobrevivência\"\nsubtitle: \"Modelos Paramétricos TFA (AFT)\"\nauthor: \"Ricardo Accioly\"\nformat:\n html:\n    code-link: true\n    fig-width: 9\n    fig-height: 7\n    fig-dpi: 300\nknitr:\n  opts_chunk: \n    out.width: 90%\n    comment: \"#>\"\n---\n\n\n## Modelo TFA Exponencial\n\nO conjunto de dados carregados a seguir são de 238 pacientes viciados com heroína.\n\nOs pacientes foram tratados em duas clínicas (1 e 2), além disso foram coletadas informações sobre dose de medicamento ministrado no tratamento e se o paciente já havia sido preso ou não.\n\nOs tempos (`survt`) são em dias e o evento analisado foi o tempo até a saída da clínica (status=1) ou o tempo até o término de estudo (tempo censurado (status=0).\n\n-   id: Identificação do paciente\n-   clinic: clinica em que ocorreu o tratamento\n-   survt: tempo até a saída da clínica (dias)\n-   status: censoring status 0=censored (censurado), 1=evento\n-   prison: 0= se nunca foi preso e 1= se já foi preso\n-   dose: dose do medicamento ministradp\n\n## Carregando os dados\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nlibrary(survival)\nlibrary(readxl)\ndados <- read_xlsx(\"heroina.xlsx\", col_names = TRUE )\nsummary(dados)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        id             clinic          status           survt       \n#>  Min.   :  1.00   Min.   :1.000   Min.   :0.0000   Min.   :   2.0  \n#>  1st Qu.: 65.25   1st Qu.:1.000   1st Qu.:0.0000   1st Qu.: 171.2  \n#>  Median :131.50   Median :1.000   Median :1.0000   Median : 367.5  \n#>  Mean   :134.13   Mean   :1.315   Mean   :0.6303   Mean   : 402.6  \n#>  3rd Qu.:205.75   3rd Qu.:2.000   3rd Qu.:1.0000   3rd Qu.: 585.5  \n#>  Max.   :266.00   Max.   :2.000   Max.   :1.0000   Max.   :1076.0  \n#>      prison            dose      \n#>  Min.   :0.0000   Min.   : 20.0  \n#>  1st Qu.:0.0000   1st Qu.: 50.0  \n#>  Median :0.0000   Median : 60.0  \n#>  Mean   :0.4664   Mean   : 60.4  \n#>  3rd Qu.:1.0000   3rd Qu.: 70.0  \n#>  Max.   :1.0000   Max.   :110.0\n```\n:::\n:::\n\n\n## Avaliando presença de dados ausentes\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nnrow(dados)\nsum(complete.cases(dados))\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 238\n#> [1] 238\n```\n:::\n:::\n\n\n## Ajuste do Modelo Exponencial\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nTFAExp <- survreg(Surv(survt, status) ~ clinic + prison + dose,\n                   dist = \"exponential\", \n                   data=dados)\nsummary(TFAExp)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> survreg(formula = Surv(survt, status) ~ clinic + prison + dose, \n#>     data = dados, dist = \"exponential\")\n#>                Value Std. Error     z       p\n#> (Intercept)  3.68434    0.43072  8.55 < 2e-16\n#> clinic       0.88058    0.21063  4.18 2.9e-05\n#> prison      -0.25265    0.16489 -1.53    0.13\n#> dose         0.02892    0.00614  4.71 2.5e-06\n#> \n#> Scale fixed at 1 \n#> \n#> Exponential distribution\n#> Loglik(model)= -1094   Loglik(intercept only)= -1118.9\n#> \tChisq= 49.91 on 3 degrees of freedom, p= 8.3e-11 \n#> Number of Newton-Raphson Iterations: 5 \n#> n= 238\n```\n:::\n:::\n\n\nA variável prison é marginalmente significativa considerando um nível de significância de 0,10.\n\n\n## Usando o AIC\n\nVamos usar o AIC para selecionar variáveis e verificar se devemos retirar a variável prison\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)\nTFAExp1 <- stepAIC(TFAExp, trace = FALSE)\nsummary(TFAExp1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> survreg(formula = Surv(survt, status) ~ clinic + prison + dose, \n#>     data = dados, dist = \"exponential\")\n#>                Value Std. Error     z       p\n#> (Intercept)  3.68434    0.43072  8.55 < 2e-16\n#> clinic       0.88058    0.21063  4.18 2.9e-05\n#> prison      -0.25265    0.16489 -1.53    0.13\n#> dose         0.02892    0.00614  4.71 2.5e-06\n#> \n#> Scale fixed at 1 \n#> \n#> Exponential distribution\n#> Loglik(model)= -1094   Loglik(intercept only)= -1118.9\n#> \tChisq= 49.91 on 3 degrees of freedom, p= 8.3e-11 \n#> Number of Newton-Raphson Iterations: 5 \n#> n= 238\n```\n:::\n:::\n\n\nVemos que através do AIC não há evidências de que devemos retirar prison do modelo.\n\n\n## Método de Kaplan-Meier\n\nVamos suar o método de Kaplan-Meier para visualizar a diferença entre a clinica 1 e a clinica 2\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\najusteKM <- survfit(Surv(survt, status) ~ clinic, data = dados)\nplot(ajusteKM, xlab=\"T(dias)\",ylab=\"S(t)\", lty=1:2, col = 1:2) \nlegend(\"topright\", bty = \"n\", lty = 1:2, col = 1:2,\nlegend = sprintf(\"clinic %d\", 1:2))\n```\n````\n\n::: {.cell-output-display}\n![](Aula06x_files/figure-html/unnamed-chunk-5-1.png){width=90%}\n:::\n:::\n\n\n## Avaliação dos resultados\n\nFator de aceleração/desacelaração obtido\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ncoefExp <- coef(TFAExp1)\nexp(coefExp[2])\nexp(coefExp[3])\nexp(coefExp[4])\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#>   clinic \n#> 2.412303 \n#>    prison \n#> 0.7767404 \n#>     dose \n#> 1.029339\n```\n:::\n:::\n\n\nA mudança da clinica 1 para a clinica 2 teve um fator de 2,35, ou seja, na mesma probabilidade o tempo até o evento na clinica 2 é 2,35 vezes maior do que na clínica 1.\n\nA ausência de prisão anterior reduziu i tempo até o tempo até o evento, o fator de desaceleração foi de 0,77.\n\nA mudança na dose aumentou ligeiramente o tempo até o evento, o fator foi de 1,02\n\n## Novos dados\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nnovosdados <- data.frame(clinic = c(\"1\", \"2\"),\n                         prison = c(0, 0), dose = c(60, 60))\nprevis <- predict(TFAExp1, type = \"quantile\", newdata = novosdados, p = 0.5)\nprevis\nprevis[2]/previs[1]\nprevis <- predict(TFAExp1, type = \"quantile\", \n                  newdata = novosdados, p = 0.7)\nprevis\nprevis[2]/previs[1]\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        1        2 \n#> 156.4648 377.4406 \n#>        2 \n#> 2.412303 \n#>        1        2 \n#> 271.7740 655.6013 \n#>        2 \n#> 2.412303\n```\n:::\n:::\n\n\nVeja que no modelo TFA a proporcionalidade é verificada em diferentes quantis da curva de sobrevivência\n",
    "supporting": [
      "Aula06x_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}