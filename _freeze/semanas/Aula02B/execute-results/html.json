{
  "hash": "6a063585b313fe857ac46240d5e53cb9",
  "result": {
    "markdown": "---\ntitle: \"Análise de Sobrevivência\"\nsubtitle: \"Modelos não Paramétricos\"\nauthor: \"Prof. Ricardo Accioly\"\nformat:\n  revealjs:\n    slide-number: true\n    css: styles.css\n    theme: dark\n    footer: \"IME05-12532 - Análise de Sobrevivência\"\n---\n\n\n## Análise de Sobrevivência (1)\n\nNesta apresentação vamos ver passo a passo como obter uma estimativa da curva de sobrevivência através do método de Kaplan-Meier.\n\nVamos inicialmente utilizar o pacote `survival` que é a principal referência em modelos de análise de sobrevivência.\n\n## Análise de Sobrevivência (2)\n\nVamos usar neste exemplo dados de pacientes com leucemia.\n\nO objetivo é verificar se o tratamento proposto, 6MP, tem efeito sobre a doença.\n\nExistem dois grupos de pacientes:\n\n-   21 receberam 6MP que é um medicamento para tratar leucemia\n-   Os outros 21 receberam placebo.\n\n::: {.fragment .highlight-red}\nO evento falha aqui é ocorrer uma recaída na doença.\n:::\n\n## Método Kaplan-Meier {.smaller}\n\n::: panel-tabset\n### Ajuste\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nlibrary(survival)\ntempo<- c(6,6,6,6,7,9,10,10,11,13,16,17,19,20,22,23,25,32,32,34,35)\nstatus<- c(1,1,1,0,1,0,1,0,0,1,1,0,0,0,1,1,0,0,0,0,0) \ntempo2<- c(1,1,2,2,3,4,4,5,5,8,8,8,8,11,11,12,12,15,17,22,23)\nstatus2<- c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1) \ntempo2g <- c(tempo,tempo2)\nstatus2g <- c(status,status2)\ngrupos <- c(rep(1,21),rep(2,21))\ndados <- data.frame(tempos=tempo2g, status=status2g, grupos=grupos)\najusteKM <- survfit(Surv(tempos, status) ~ grupos, data=dados)\n```\n````\n:::\n\n\n### Grafico\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nplot(ajusteKM, xlab=\"T(semanas)\",ylab=\"S(t)\", lty=2:3) \nlegend(\"topright\",c(\"6-MP\",\"Placebo\"), lty = 2:3)\n```\n````\n\n::: {.cell-output-display}\n![](Aula02B_files/figure-revealjs/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\n:::\n\n## Método Kaplan-Meier {.smaller}\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nsummary(ajusteKM)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\nCall: survfit(formula = Surv(tempos, status) ~ grupos, data = dados)\n\n                grupos=1 \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    6     21       3    0.857  0.0764        0.720        1.000\n    7     17       1    0.807  0.0869        0.653        0.996\n   10     15       1    0.753  0.0963        0.586        0.968\n   13     12       1    0.690  0.1068        0.510        0.935\n   16     11       1    0.627  0.1141        0.439        0.896\n   22      7       1    0.538  0.1282        0.337        0.858\n   23      6       1    0.448  0.1346        0.249        0.807\n\n                grupos=2 \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    1     21       2   0.9048  0.0641      0.78754        1.000\n    2     19       2   0.8095  0.0857      0.65785        0.996\n    3     17       1   0.7619  0.0929      0.59988        0.968\n    4     16       2   0.6667  0.1029      0.49268        0.902\n    5     14       2   0.5714  0.1080      0.39455        0.828\n    8     12       4   0.3810  0.1060      0.22085        0.657\n   11      8       2   0.2857  0.0986      0.14529        0.562\n   12      6       2   0.1905  0.0857      0.07887        0.460\n   15      4       1   0.1429  0.0764      0.05011        0.407\n   17      3       1   0.0952  0.0641      0.02549        0.356\n   22      2       1   0.0476  0.0465      0.00703        0.322\n   23      1       1   0.0000     NaN           NA           NA\n```\n:::\n:::\n\n\n## Teste do log-rank\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nsurvdiff(Surv(tempos, status) ~ grupos, data=dados)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(tempos, status) ~ grupos, data = dados)\n\n          N Observed Expected (O-E)^2/E (O-E)^2/V\ngrupos=1 21        9     19.3      5.46      16.8\ngrupos=2 21       21     10.7      9.77      16.8\n\n Chisq= 16.8  on 1 degrees of freedom, p= 4e-05 \n```\n:::\n:::\n\n\n## Teste do log-rank usando pesos\n\nQuando usamo rho=0, o teste é identico ao log-rank padrão\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# rho=0 é o teste de log-rank\nsurvdiff(Surv(tempos, status) ~ grupos, rho=0, data=dados)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(tempos, status) ~ grupos, data = dados, \n    rho = 0)\n\n          N Observed Expected (O-E)^2/E (O-E)^2/V\ngrupos=1 21        9     19.3      5.46      16.8\ngrupos=2 21       21     10.7      9.77      16.8\n\n Chisq= 16.8  on 1 degrees of freedom, p= 4e-05 \n```\n:::\n:::\n\n\n## Usando pesos de Peto&Peto (HF)\n\nQuando usamo rho=1, ele se torna do teste de log-rank usando os pesos de Peto&Peto\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# rho=1 é o teste de Peto&Peto\nsurvdiff(Surv(tempos, status) ~ grupos, rho=1, data=dados)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(tempos, status) ~ grupos, data = dados, \n    rho = 1)\n\n          N Observed Expected (O-E)^2/E (O-E)^2/V\ngrupos=1 21     5.12    12.00      3.94      14.5\ngrupos=2 21    14.55     7.68      6.16      14.5\n\n Chisq= 14.5  on 1 degrees of freedom, p= 1e-04 \n```\n:::\n:::\n\n\n## Teste do Log-rank para mais de 2 grupos {.smaller}\n\nVamos usar neste exemplo os dados de um estudo experimental com camundongos conduzido no Centro de Pesquisas René Rachou, FioCruz, MG.\n\n44 camundongos foram infectados pela malaria (Plasmodium berguei) e aleatoriamente alocados em três grupos:\n\n`Grupo 1`: Imunizados 30 dias antes da infecção pela malária. Foram infetados também por esquistossomose.\n\n`Grupo 2`: Controle (Somente infectado pela malária)\n\n`Grupo 3`: Infectado pela malária e ela esquistossomose.\n\n## Teste do Log-rank para mais de 2 grupos\n\nA resposta foi o tempo decorrido desde a infecção pela malária até a morte do camundongo. O tempo foi medido em dias e o estudo foi acompanhado por 30 dias.\n\nVamos adotar um `nível de significância` de 0,05 para avaliar a diferença entre as curvas, ou seja, se a estatística de `log-rank` tiver um valor menor que 0,05, vamos rejeitar a hipótese nula.\n\n## Método Kaplan-Meier\n\n::: panel-tabset\n### Ajuste\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ntempos <- c(7,8,8,8,8,12,12,17,18,22,30,30,30,30,30,30,8,8,9,\n10,10,14,15,15,18,19,21,22,22,23,25,8,8,8,8,8,8,\n9,10,10,10,11,17,19)\nstatus <- c(rep(1,10), rep(0,6), rep(1,15), rep(1,13))\ngrupos <- c(rep(1,16), rep(2,15), rep(3,13))\ndados2 <- data.frame(tempos, status, grupos)\najusteKM2<- survfit(Surv(tempos, status) ~ grupos, data = dados2)\n```\n````\n:::\n\n\n### Grafico\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(ajusteKM2, xlab=\"T(dias)\",ylab=\"S(t)\", lty=1:3) \nlegend(\"topright\",c(\"G 1\",\"G 2\", \"G 3\"), lty = 1:3)\n```\n\n::: {.cell-output-display}\n![](Aula02B_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n:::\n\n## Teste do log-rank\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvdiff(Surv(tempos, status) ~ grupos, data = dados2,  rho=0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(tempos, status) ~ grupos, data = dados2, \n    rho = 0)\n\n          N Observed Expected (O-E)^2/E (O-E)^2/V\ngrupos=1 16       10    17.00    2.8816    6.4111\ngrupos=2 15       15    14.51    0.0167    0.0317\ngrupos=3 13       13     6.49    6.5190   10.4447\n\n Chisq= 12.6  on 2 degrees of freedom, p= 0.002 \n```\n:::\n:::\n\n\n## Avaliação {.smaller}\n\nComo a hipótese nula foi rejeitada precisamos avaliar se todas as curvas de sobrevivência são diferentes. Para isto vamos fazer comparações, duas a duas, utilizando o método de `Bonferroni`.\n\nComo existem três grupos, são três as comparações duas a duas.\n\nO nível de significância a ser adotado nestas comparações é de $\\alpha$ = 0,05/3 = 0,017. Isto vai garantir uma conclusão geral ao nível máximo de 0,05.\n\n## Grupos 1 e 2\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvdiff(Surv(tempos, status) ~ grupos, data = subset(dados2, grupos!=3),  rho=0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(tempos, status) ~ grupos, data = subset(dados2, \n    grupos != 3), rho = 0)\n\n          N Observed Expected (O-E)^2/E (O-E)^2/V\ngrupos=1 16       10     13.7      1.01      2.53\ngrupos=2 15       15     11.3      1.23      2.53\n\n Chisq= 2.5  on 1 degrees of freedom, p= 0.1 \n```\n:::\n:::\n\n\n## Grupos 1 e 3\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvdiff(Surv(tempos, status) ~ grupos, data = subset(dados2, grupos!=2),  rho=0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(tempos, status) ~ grupos, data = subset(dados2, \n    grupos != 2), rho = 0)\n\n          N Observed Expected (O-E)^2/E (O-E)^2/V\ngrupos=1 16       10    15.34      1.86      7.86\ngrupos=3 13       13     7.66      3.72      7.86\n\n Chisq= 7.9  on 1 degrees of freedom, p= 0.005 \n```\n:::\n:::\n\n\n## Grupos 2 e 3\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvdiff(Surv(tempos, status) ~ grupos, data = subset(dados2, grupos!=1),  rho=0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(tempos, status) ~ grupos, data = subset(dados2, \n    grupos != 1), rho = 0)\n\n          N Observed Expected (O-E)^2/E (O-E)^2/V\ngrupos=2 15       15    20.53      1.49      7.98\ngrupos=3 13       13     7.47      4.08      7.98\n\n Chisq= 8  on 1 degrees of freedom, p= 0.005 \n```\n:::\n:::\n\n\n## Curva de Sobrevivência estratificada {.smaller}\n\nNeste exemplo temos 2 tratamentos, mas queremos controlar os resultados considerando uma variável categórica (sexo).\n\nO evento estudado é o tempo até a `recaída` de leucemia.\n\nO conjunto de dados tem os seguintes informação:\n\n-   tempo (semanas)\n-   status (0 = censura e 1 = falha)\n-   sexo (0 = mulher e 1 = homem)\n-   logwbc = log do número de células brancas\n-   Rx (0 = Novo tratamento e 1 = Placebo)\n\nVamos ver como isto pode ser feito na função survfit.\n\n## Curva de Sobrevivência estratificada\n\n::: panel-tabset\n### Ajuste\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nlibrary(readxl)\ndados_a <- read_xlsx(\"anderson.xlsx\", col_names=T)\najusteKM_S <- survfit(Surv(tempo, status) ~ Rx + strata(sexo), data = dados_a)\n```\n````\n:::\n\n\n### Grafico\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(ajusteKM_S, xlab=\"T(semanas)\",ylab=\"S(t)\", lty=1:4) \nlegend(\"topright\",c(\"Rx=0 e Sexo=M\",\"Rx=0 e Sexo=F\", \"Rx=1 e Sexo=M\", \"Rx=1 e Sexo=F\"), lty = 1:4)\n```\n\n::: {.cell-output-display}\n![](Aula02B_files/figure-revealjs/unnamed-chunk-14-1.png){width=960}\n:::\n:::\n\n:::\n\n## Teste do log-rank\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvdiff(Surv(tempo, status) ~ Rx, data = dados_a)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(tempo, status) ~ Rx, data = dados_a)\n\n      N Observed Expected (O-E)^2/E (O-E)^2/V\nRx=0 21        9     19.3      5.46      16.8\nRx=1 21       21     10.7      9.77      16.8\n\n Chisq= 16.8  on 1 degrees of freedom, p= 4e-05 \n```\n:::\n\n```{.r .cell-code}\nsurvdiff(Surv(tempo, status) ~ Rx + strata(sexo), data = dados_a)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvdiff(formula = Surv(tempo, status) ~ Rx + strata(sexo), data = dados_a)\n\n      N Observed Expected (O-E)^2/E (O-E)^2/V\nRx=0 21        9     16.5      3.44       9.7\nRx=1 21       21     13.5      4.23       9.7\n\n Chisq= 9.7  on 1 degrees of freedom, p= 0.002 \n```\n:::\n:::\n",
    "supporting": [
      "Aula02B_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\r\n<script>\r\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\r\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\r\n  // slide changes (different for each slide format).\r\n  (function () {\r\n    // dispatch for htmlwidgets\r\n    function fireSlideEnter() {\r\n      const event = window.document.createEvent(\"Event\");\r\n      event.initEvent(\"slideenter\", true, true);\r\n      window.document.dispatchEvent(event);\r\n    }\r\n\r\n    function fireSlideChanged(previousSlide, currentSlide) {\r\n      fireSlideEnter();\r\n\r\n      // dispatch for shiny\r\n      if (window.jQuery) {\r\n        if (previousSlide) {\r\n          window.jQuery(previousSlide).trigger(\"hidden\");\r\n        }\r\n        if (currentSlide) {\r\n          window.jQuery(currentSlide).trigger(\"shown\");\r\n        }\r\n      }\r\n    }\r\n\r\n    // hookup for slidy\r\n    if (window.w3c_slidy) {\r\n      window.w3c_slidy.add_observer(function (slide_num) {\r\n        // slide_num starts at position 1\r\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\r\n      });\r\n    }\r\n\r\n  })();\r\n</script>\r\n\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}