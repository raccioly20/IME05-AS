{
  "hash": "660ef7109f4c604128d8123790afbcda",
  "result": {
    "markdown": "---\ntitle: \"Análise de Sobrevivência\"\nsubtitle: \"Modelos Paramétricos TFA (AFT)\"\nauthor: \"Ricardo Accioly\"\nformat:\n html:\n    code-link: true\n    fig-width: 9\n    fig-height: 7\n    fig-dpi: 300\nknitr:\n  opts_chunk: \n    out.width: 90%\n    comment: \"#>\"\n---\n\n\n## Modelos TFA\n\nO conjunto de dados carregados a seguir são de 238 pacientes viciados com heroína.\n\nOs pacientes foram tratados em duas clínicas (1 e 2), além disso foram coletadas informações sobre dose de medicamento ministrado no tratamento e se o paciente já havia sido preso ou não.\n\nOs tempos (`survt`) são em dias e o evento analisado foi o tempo até a saída da clínica (status=1) ou o tempo até o término de estudo (tempo censurado (status=0).\n\n-   id: Identificação do paciente\n-   clinic: clinica em que ocorreu o tratamento\n-   survt: tempo até a saída da clínica (dias)\n-   status: censoring status 0=censored (censurado), 1=evento\n-   prison: 0= se nunca foi preso e 1= se já foi preso\n-   dose: dose do medicamento ministradp\n\n## Carregando os dados\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nlibrary(survival)\nlibrary(readxl)\ndados <- read_xlsx(\"heroina.xlsx\", col_names = TRUE )\nsummary(dados)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        id             clinic          status           survt       \n#>  Min.   :  1.00   Min.   :1.000   Min.   :0.0000   Min.   :   2.0  \n#>  1st Qu.: 65.25   1st Qu.:1.000   1st Qu.:0.0000   1st Qu.: 171.2  \n#>  Median :131.50   Median :1.000   Median :1.0000   Median : 367.5  \n#>  Mean   :134.13   Mean   :1.315   Mean   :0.6303   Mean   : 402.6  \n#>  3rd Qu.:205.75   3rd Qu.:2.000   3rd Qu.:1.0000   3rd Qu.: 585.5  \n#>  Max.   :266.00   Max.   :2.000   Max.   :1.0000   Max.   :1076.0  \n#>      prison            dose      \n#>  Min.   :0.0000   Min.   : 20.0  \n#>  1st Qu.:0.0000   1st Qu.: 50.0  \n#>  Median :0.0000   Median : 60.0  \n#>  Mean   :0.4664   Mean   : 60.4  \n#>  3rd Qu.:1.0000   3rd Qu.: 70.0  \n#>  Max.   :1.0000   Max.   :110.0\n```\n:::\n:::\n\n\n## Avaliando presença de dados ausentes\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nnrow(dados)\nsum(complete.cases(dados))\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 238\n#> [1] 238\n```\n:::\n:::\n\n\n## Modelo Exponencial\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nTFAExp <- survreg(Surv(survt,status)~ clinic + prison + dose,dist='exponential', data=dados)\nsummary(TFAExp)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> survreg(formula = Surv(survt, status) ~ clinic + prison + dose, \n#>     data = dados, dist = \"exponential\")\n#>                Value Std. Error     z       p\n#> (Intercept)  3.68434    0.43072  8.55 < 2e-16\n#> clinic       0.88058    0.21063  4.18 2.9e-05\n#> prison      -0.25265    0.16489 -1.53    0.13\n#> dose         0.02892    0.00614  4.71 2.5e-06\n#> \n#> Scale fixed at 1 \n#> \n#> Exponential distribution\n#> Loglik(model)= -1094   Loglik(intercept only)= -1118.9\n#> \tChisq= 49.91 on 3 degrees of freedom, p= 8.3e-11 \n#> Number of Newton-Raphson Iterations: 5 \n#> n= 238\n```\n:::\n:::\n\n\n## Modelo Weibull\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nTFAWei <- survreg(Surv(survt, status) ~ clinic + prison + dose,\n                   dist = \"weibull\", \n                   data=dados)\nsummary(TFAWei)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> survreg(formula = Surv(survt, status) ~ clinic + prison + dose, \n#>     data = dados, dist = \"weibull\")\n#>                Value Std. Error     z       p\n#> (Intercept)  4.10485    0.32806 12.51 < 2e-16\n#> clinic       0.70904    0.15722  4.51 6.5e-06\n#> prison      -0.22947    0.12079 -1.90   0.057\n#> dose         0.02443    0.00459  5.32 1.0e-07\n#> Log(scale)  -0.31495    0.06756 -4.66 3.1e-06\n#> \n#> Scale= 0.73 \n#> \n#> Weibull distribution\n#> Loglik(model)= -1084.5   Loglik(intercept only)= -1114.9\n#> \tChisq= 60.89 on 3 degrees of freedom, p= 3.8e-13 \n#> Number of Newton-Raphson Iterations: 7 \n#> n= 238\n```\n:::\n:::\n\n\n## Previsão na mediana do tempo entre eventos\n\nAqui estamos mantendo as variáveis prisão e dose fixas somente variando a clínica\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nnovosdados <- data.frame(clinic = c(\"1\", \"2\"),\n                         prison = c(0, 0), dose = c(60, 60))\nprevis <- predict(TFAWei, type = \"quantile\", \n                  newdata = novosdados, p = 0.5)\nprevis\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        1        2 \n#> 200.9142 408.2661\n```\n:::\n:::\n\n\n## Razão entre as previsões dos dois grupos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprevis[2]/previs[1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        2 \n#> 2.032042\n```\n:::\n:::\n\n\n## Previsão em outro Quantil\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprevis <- predict(TFAWei, type = \"quantile\", \n                  newdata = novosdados, p = 0.7)\nprevis\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        1        2 \n#> 300.6186 610.8697\n```\n:::\n:::\n\n\n## Razão entre as previsões dos dois grupos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprevis[2]/previs[1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        2 \n#> 2.032042\n```\n:::\n:::\n\n\n## Função auxiliar\n\nUma função para suavizar os pontos da nuvem de resíduos do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsmoothSEcurve <- function(yy, xx) {\n# usar depois de chamar um grafico\n# Ajusta um curva lowess curve com IC de 95%\n## Facilita a avaliação dos resíduos\nxx.list <- min(xx) + ((0:100)/100)*(max(xx) - min(xx))\nyy.xx <- predict(loess(yy ~ xx), se=T,\nnewdata=data.frame(xx=xx.list))\nlines(yy.xx$fit ~ xx.list, lwd=2)\nlines(yy.xx$fit -\nqt(0.975, yy.xx$df)*yy.xx$se.fit ~ xx.list, lty=2)\nlines(yy.xx$fit +\nqt(0.975, yy.xx$df)*yy.xx$se.fit ~ xx.list, lty=2)\n}\n```\n:::\n\n\n## Diagnóstico do Modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(car)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Carregando pacotes exigidos: carData\n```\n:::\n\n```{.r .cell-code}\npar(mfrow = c(1, 2), cex = 0.6)\npred.lin <- predict(TFAWei, type = \"lp\")[dados$status == 1]\nlog.resid <- log(dados$survt[dados$status == 1]) - pred.lin\nplot(pred.lin, log.resid, main = \"Grafico TA\",\nxlab = \"log(valores ajustados)\", ylab = \"log(residuos)\")\nsmoothSEcurve(log.resid, pred.lin)\nqqPlot(exp(log.resid), dist = \"weibull\",\nshape = 1/TFAWei$scale,\nmain = \"Grafico Q-Q\", xlab = \"Quantis teoricos Weibull\", ylab = \"Quantis empiricos\")\n```\n\n::: {.cell-output-display}\n![](Aula06x1_files/figure-html/unnamed-chunk-10-1.png){width=90%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 69  8\n```\n:::\n:::\n\n\n## Modelo Lognormal\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nTFALn <- survreg(Surv(survt, status) ~ clinic + prison + dose,\n                   dist = \"lognormal\", \n                   data=dados)\nsummary(TFALn)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> survreg(formula = Surv(survt, status) ~ clinic + prison + dose, \n#>     data = dados, dist = \"lognormal\")\n#>                Value Std. Error     z      p\n#> (Intercept)  3.40684    0.39769  8.57 <2e-16\n#> clinic       0.57649    0.17648  3.27 0.0011\n#> prison      -0.30904    0.15431 -2.00 0.0452\n#> dose         0.03367    0.00568  5.93  3e-09\n#> Log(scale)   0.07476    0.05930  1.26 0.2074\n#> \n#> Scale= 1.08 \n#> \n#> Log Normal distribution\n#> Loglik(model)= -1097.8   Loglik(intercept only)= -1123.7\n#> \tChisq= 51.85 on 3 degrees of freedom, p= 3.2e-11 \n#> Number of Newton-Raphson Iterations: 4 \n#> n= 238\n```\n:::\n:::\n\n\n## Previsões na mediana\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nprevis <- predict(TFALn, type = \"quantile\", \n                  newdata = novosdados, p = 0.5)\nprevis\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        1        2 \n#> 227.5381 404.9681\n```\n:::\n:::\n\n\n## Razão das previsões na mediana\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprevis[2]/previs[1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        2 \n#> 1.779782\n```\n:::\n:::\n\n\n## Outro Quantil\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprevis <- predict(TFALn, type = \"quantile\", \n                  newdata = novosdados, p = 0.7)\nprevis\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        1        2 \n#> 400.3836 712.5953\n```\n:::\n:::\n\n\n## Razão das previsões noutro quantil\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprevis[2]/previs[1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        2 \n#> 1.779782\n```\n:::\n:::\n\n\n## Diagnóstico do Modelo\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\npar(mfrow = c(1, 2), cex = 0.6)\npred.lin <- predict(TFALn, type = \"lp\")[dados$status == 1]\nlog.resid <- log(dados$survt[dados$status == 1]) - pred.lin\nplot(pred.lin, log.resid, main = \"Grafico TA\",\nxlab = \"log(valores ajustados)\", ylab = \"log(residuos)\")\nsmoothSEcurve(log.resid, pred.lin)\nqqPlot(log.resid, dist = \"norm\", sd=TFALn$scale, \nmain = \"Grafico Q-Q\", xlab = \"Quantis teoricos Lognormal\", ylab = \"Quantis empiricos\")\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1]  86 110\n```\n:::\n\n::: {.cell-output-display}\n![](Aula06x1_files/figure-html/unnamed-chunk-16-1.png){width=90%}\n:::\n:::\n\n\n## Modelo Loglogistico\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nTFALl <- survreg(Surv(survt, status) ~ clinic + prison + dose,\n                   dist = \"loglogistic\", \n                   data=dados)\nsummary(TFALl)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> survreg(formula = Surv(survt, status) ~ clinic + prison + dose, \n#>     data = dados, dist = \"loglogistic\")\n#>                Value Std. Error     z       p\n#> (Intercept)  3.56327    0.38945  9.15 < 2e-16\n#> clinic       0.58060    0.17157  3.38 0.00071\n#> prison      -0.29127    0.14396 -2.02 0.04305\n#> dose         0.03161    0.00552  5.73 1.0e-08\n#> Log(scale)  -0.53314    0.06863 -7.77 7.9e-15\n#> \n#> Scale= 0.587 \n#> \n#> Log logistic distribution\n#> Loglik(model)= -1093.9   Loglik(intercept only)= -1120\n#> \tChisq= 52.18 on 3 degrees of freedom, p= 2.7e-11 \n#> Number of Newton-Raphson Iterations: 4 \n#> n= 238\n```\n:::\n:::\n\n\n## Previsões na mediana\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nprevis <- predict(TFALl, type = \"quantile\", \n                  newdata = novosdados, p = 0.5)\nprevis\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        1        2 \n#> 235.1125 420.1710\n```\n:::\n:::\n\n\n## Razão das previsões na mediana\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprevis[2]/previs[1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        2 \n#> 1.787106\n```\n:::\n:::\n\n\n## Outro quantil\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprevis <- predict(TFALl, type = \"quantile\", \n                  newdata = novosdados, p = 0.7)\nprevis\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        1        2 \n#> 386.5353 690.7797\n```\n:::\n:::\n\n\n## Razão das previsões\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprevis[2]/previs[1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        2 \n#> 1.787106\n```\n:::\n:::\n\n\n## Diagnóstico do Modelo\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\npar(mfrow = c(1, 2), cex = 0.6)\npred.lin <- predict(TFALl, type = \"lp\")[dados$status == 1]\nlog.resid <- log(dados$survt[dados$status == 1]) - pred.lin\nplot(pred.lin, log.resid, main = \"Grafico TA\",\nxlab = \"log(valores ajustados)\", ylab = \"log(residuos)\")\nsmoothSEcurve(log.resid, pred.lin)\nqqPlot(log.resid, dist = \"logis\", \nmain = \"Grafico Q-Q\", xlab = \"Quantis teoricos Logistica\", ylab = \"Quantis empiricos\")\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1]  86 110\n```\n:::\n\n::: {.cell-output-display}\n![](Aula06x1_files/figure-html/unnamed-chunk-22-1.png){width=90%}\n:::\n:::\n",
    "supporting": [
      "Aula06x1_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}