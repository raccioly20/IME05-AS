{
  "hash": "72ed0c4334e12f0509d86c8e2f3e3382",
  "result": {
    "markdown": "---\ntitle: \"Análise de Sobrevivência\"\nsubtitle: \"Estratificação no Modelo de Cox\"\nauthor: \"Ricardo Accioly\"\nformat:\n html:\n    code-link: true\n    fig-width: 9\n    fig-height: 7\n    fig-dpi: 300\nknitr:\n  opts_chunk: \n    out.width: 90%\n    comment: \"#>\"\n---\n\n\n## Estratificação no Modelo de Cox {.smaller .scrollable}\n\nVamos usar o conjunto de dados da biblioteca `survival` denominado veteran.\n\nOs dados são de um estudo clínico realizado pela Administração de Veteranos sobre veteranos do sexo masculino com câncer de pulmão avançado e inoperável.\n\nNo ensaio, os pacientes foram randomizados para receber uma quimioterapia padrão ou uma quimioterapia experimental, e o tempo final foi o tempo até a morte\n\nOs dados coletados foram:\n\n-   trt: tratamento padrão=1 experimental=2\n-   celltype: tipo de tumor (1=squamous, 2=celula pequena, 3=adenocarcinoma, 4=grande)\n-   time: tempo de sobrevivência (dias)\n-   status: censoring status 0=censored (censurado), 1=evento\n-   karno: Karnofsky score, um método de quantificar o status básico do paciente\n-   diagtime: tempo em meses do diagnóstico até a aleatorização\n-   age: idade em anos na aleatorização\n-   prior: terapia anterior 0=não e 10=sim\n\n## Carregando os dados\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nlibrary(survival)\ndados <- veteran\nsummary(dados)\nstr(dados)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#>       trt             celltype       time           status      \n#>  Min.   :1.000   squamous :35   Min.   :  1.0   Min.   :0.0000  \n#>  1st Qu.:1.000   smallcell:48   1st Qu.: 25.0   1st Qu.:1.0000  \n#>  Median :1.000   adeno    :27   Median : 80.0   Median :1.0000  \n#>  Mean   :1.496   large    :27   Mean   :121.6   Mean   :0.9343  \n#>  3rd Qu.:2.000                  3rd Qu.:144.0   3rd Qu.:1.0000  \n#>  Max.   :2.000                  Max.   :999.0   Max.   :1.0000  \n#>      karno          diagtime           age            prior      \n#>  Min.   :10.00   Min.   : 1.000   Min.   :34.00   Min.   : 0.00  \n#>  1st Qu.:40.00   1st Qu.: 3.000   1st Qu.:51.00   1st Qu.: 0.00  \n#>  Median :60.00   Median : 5.000   Median :62.00   Median : 0.00  \n#>  Mean   :58.57   Mean   : 8.774   Mean   :58.31   Mean   : 2.92  \n#>  3rd Qu.:75.00   3rd Qu.:11.000   3rd Qu.:66.00   3rd Qu.:10.00  \n#>  Max.   :99.00   Max.   :87.000   Max.   :81.00   Max.   :10.00  \n#> 'data.frame':\t137 obs. of  8 variables:\n#>  $ trt     : num  1 1 1 1 1 1 1 1 1 1 ...\n#>  $ celltype: Factor w/ 4 levels \"squamous\",\"smallcell\",..: 1 1 1 1 1 1 1 1 1 1 ...\n#>  $ time    : num  72 411 228 126 118 10 82 110 314 100 ...\n#>  $ status  : num  1 1 1 1 1 1 1 1 1 0 ...\n#>  $ karno   : num  60 70 60 60 70 20 40 80 50 70 ...\n#>  $ diagtime: num  7 5 3 9 11 5 10 29 18 6 ...\n#>  $ age     : num  69 64 38 63 65 49 69 68 43 70 ...\n#>  $ prior   : num  0 10 0 10 10 0 10 0 0 0 ...\n```\n:::\n:::\n\n\n## Verificando dados ausentes\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nnrow(dados)\nsum(complete.cases(dados))\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 137\n#> [1] 137\n```\n:::\n:::\n\n\n## Visualizando\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\najusteKM <- survfit(Surv(time/365.25, status) ~ trt, data=dados)\nplot(ajusteKM, mark.time=FALSE, col=c(1:2), lwd=3, las=1, bty='n', xlab='Tempo (anos)', ylab='Sobrevivência')\nlegend(\"topright\", c('Padrão', 'Experimental'), lwd=3, col=c(1:2))\n```\n````\n\n::: {.cell-output-display}\n![](Aula12_files/figure-html/unnamed-chunk-3-1.png){width=90%}\n:::\n:::\n\n\n## Modelo de Cox\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\najusteCox <- coxph(Surv(time/365.25, status) ~ trt + karno + diagtime + age + prior + celltype, data=dados)\nsummary(ajusteCox)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> coxph(formula = Surv(time/365.25, status) ~ trt + karno + diagtime + \n#>     age + prior + celltype, data = dados)\n#> \n#>   n= 137, number of events= 128 \n#> \n#>                         coef  exp(coef)   se(coef)      z Pr(>|z|)    \n#> trt                2.946e-01  1.343e+00  2.075e-01  1.419  0.15577    \n#> karno             -3.282e-02  9.677e-01  5.508e-03 -5.958 2.55e-09 ***\n#> diagtime           8.132e-05  1.000e+00  9.136e-03  0.009  0.99290    \n#> age               -8.706e-03  9.913e-01  9.300e-03 -0.936  0.34920    \n#> prior              7.159e-03  1.007e+00  2.323e-02  0.308  0.75794    \n#> celltypesmallcell  8.616e-01  2.367e+00  2.753e-01  3.130  0.00175 ** \n#> celltypeadeno      1.196e+00  3.307e+00  3.009e-01  3.975 7.05e-05 ***\n#> celltypelarge      4.013e-01  1.494e+00  2.827e-01  1.420  0.15574    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#>                   exp(coef) exp(-coef) lower .95 upper .95\n#> trt                  1.3426     0.7448    0.8939    2.0166\n#> karno                0.9677     1.0334    0.9573    0.9782\n#> diagtime             1.0001     0.9999    0.9823    1.0182\n#> age                  0.9913     1.0087    0.9734    1.0096\n#> prior                1.0072     0.9929    0.9624    1.0541\n#> celltypesmallcell    2.3669     0.4225    1.3799    4.0597\n#> celltypeadeno        3.3071     0.3024    1.8336    5.9647\n#> celltypelarge        1.4938     0.6695    0.8583    2.5996\n#> \n#> Concordance= 0.736  (se = 0.021 )\n#> Likelihood ratio test= 62.1  on 8 df,   p=2e-10\n#> Wald test            = 62.37  on 8 df,   p=2e-10\n#> Score (logrank) test = 66.74  on 8 df,   p=2e-11\n```\n:::\n:::\n\n\n## Usando o stepAIC\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nlibrary(MASS)\najuste_AIC <- stepAIC(ajusteCox, trace=FALSE)\nsummary(ajuste_AIC)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> coxph(formula = Surv(time/365.25, status) ~ karno + celltype, \n#>     data = dados)\n#> \n#>   n= 137, number of events= 128 \n#> \n#>                        coef exp(coef)  se(coef)      z Pr(>|z|)    \n#> karno             -0.031057  0.969421  0.005177 -5.999 1.99e-09 ***\n#> celltypesmallcell  0.715334  2.044870  0.252686  2.831  0.00464 ** \n#> celltypeadeno      1.157733  3.182711  0.292937  3.952 7.74e-05 ***\n#> celltypelarge      0.325645  1.384923  0.276680  1.177  0.23921    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#>                   exp(coef) exp(-coef) lower .95 upper .95\n#> karno                0.9694     1.0315    0.9596    0.9793\n#> celltypesmallcell    2.0449     0.4890    1.2462    3.3555\n#> celltypeadeno        3.1827     0.3142    1.7925    5.6513\n#> celltypelarge        1.3849     0.7221    0.8052    2.3820\n#> \n#> Concordance= 0.734  (se = 0.023 )\n#> Likelihood ratio test= 59.37  on 4 df,   p=4e-12\n#> Wald test            = 61.26  on 4 df,   p=2e-12\n#> Score (logrank) test = 63.94  on 4 df,   p=4e-13\n```\n:::\n:::\n\n\n## Resíduos de Schoenfeld\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ncox.zph(ajuste_AIC)\nresid.sch <- cox.zph(ajuste_AIC)\npar(mfrow=c(1,2))\nplot(resid.sch)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#>          chisq df       p\n#> karno     14.4  1 0.00015\n#> celltype  14.1  3 0.00282\n#> GLOBAL    23.6  4 9.4e-05\n```\n:::\n\n::: {.cell-output-display}\n![](Aula12_files/figure-html/unnamed-chunk-6-1.png){width=90%}\n:::\n:::\n\n\n## Estratificação\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\najusteCoxE <- coxph(Surv(time/365.25, status) ~ karno + strata(celltype), data=dados)\nsummary(ajusteCoxE)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> coxph(formula = Surv(time/365.25, status) ~ karno + strata(celltype), \n#>     data = dados)\n#> \n#>   n= 137, number of events= 128 \n#> \n#>           coef exp(coef) se(coef)      z Pr(>|z|)    \n#> karno -0.03562   0.96501  0.00554 -6.429 1.28e-10 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#>       exp(coef) exp(-coef) lower .95 upper .95\n#> karno     0.965      1.036    0.9546    0.9755\n#> \n#> Concordance= 0.695  (se = 0.025 )\n#> Likelihood ratio test= 40.97  on 1 df,   p=2e-10\n#> Wald test            = 41.33  on 1 df,   p=1e-10\n#> Score (logrank) test = 43.97  on 1 df,   p=3e-11\n```\n:::\n:::\n\n\n## Grafico\n\n\n::: {.cell}\n\n```{.r .cell-code}\najuste_aux <- survfit(ajusteCoxE)\nplot(ajuste_aux, mark.time=FALSE, col=c(1:4), lwd=3, las=1, bty='n', xlab='Tempo (anos)', ylab='Sobrevivência')\nlegend(\"topright\", levels(dados$celltype), lwd=3, col=c(1:4))\n```\n\n::: {.cell-output-display}\n![](Aula12_files/figure-html/unnamed-chunk-8-1.png){width=90%}\n:::\n:::\n\n\n## Estratificação de Karno\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Karno 100 bom\n# Karno >60 o paciente está apto a viver sozinho\n# karno 30-60 requer assintência médica\n# karno < 30 paciente hospitalizado\ndados$fkarno <- cut(dados$karno, c(0, 30, 60, 100))\najusteCoxE1 <- coxph(Surv(time/365.25, status) ~ strata(fkarno) + celltype, data=dados)\nsummary(ajusteCoxE1)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> coxph(formula = Surv(time/365.25, status) ~ strata(fkarno) + \n#>     celltype, data = dados)\n#> \n#>   n= 137, number of events= 128 \n#> \n#>                     coef exp(coef) se(coef)     z Pr(>|z|)    \n#> celltypesmallcell 0.8849    2.4228   0.2729 3.243  0.00118 ** \n#> celltypeadeno     1.2427    3.4651   0.3007 4.133 3.58e-05 ***\n#> celltypelarge     0.2804    1.3237   0.2816 0.996  0.31937    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#>                   exp(coef) exp(-coef) lower .95 upper .95\n#> celltypesmallcell     2.423     0.4128    1.4191     4.136\n#> celltypeadeno         3.465     0.2886    1.9220     6.247\n#> celltypelarge         1.324     0.7555    0.7622     2.299\n#> \n#> Concordance= 0.624  (se = 0.029 )\n#> Likelihood ratio test= 21.35  on 3 df,   p=9e-05\n#> Wald test            = 20.68  on 3 df,   p=1e-04\n#> Score (logrank) test = 22.03  on 3 df,   p=6e-05\n```\n:::\n:::\n\n\n## Grafico\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\najuste_aux1 <- survfit(ajusteCoxE1)\nplot(ajuste_aux1, mark.time=FALSE, col=c(1:3), lwd=3, las=1, bty='n', xlab='Tempo (anos)', ylab='Sobrevivência')\nlegend(\"topright\", levels(dados$fkarno), lwd=3, col=c(1:3))\n```\n````\n\n::: {.cell-output-display}\n![](Aula12_files/figure-html/unnamed-chunk-10-1.png){width=90%}\n:::\n:::\n",
    "supporting": [
      "Aula12_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}