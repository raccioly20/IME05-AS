{
  "hash": "0deb8a061f278273e429cdf213fa4e21",
  "result": {
    "markdown": "---\ntitle: \"Análise de Sobrevivência\"\nsubtitle: \"Modelos semi-paramétrico de Cox\"\nauthor: \"Ricardo Accioly\"\nformat: html\n---\n\n\n## Introdução\n\nNesta etapa vamos começar a trabalhar com o modelo semi-paramétrico de Cox\n\nO conjunto de dados a seguir chamado \"anderson.xlsx\" consiste em tempos de remissão (em semanas) em 42 pacientes com leucemia, metade dos quais recebem uma certa nova terapia de tratamento e a outra metade recebe uma terapia de tratamento padrão.\n\nA variável de exposição de interesse é o tratamento (Rx = 0 se novo tratamento, Rx = 1 se tratamento padrão).\n\nDuas outras variáveis para controle como potenciais confundidores são a contagem de glóbulos brancos (ou seja, logwbc) e sexo. O status de falha é definido pela variável recaída (0 se censurado, 1 se falhar).\n\n## Carregando os dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survival)\nlibrary(readxl)\ndados <- read_xlsx(\"anderson.xlsx\", col_names = TRUE )\nsummary(dados)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     tempo           status            sexo            logwbc     \n Min.   : 1.00   Min.   :0.0000   Min.   :0.0000   Min.   :1.450  \n 1st Qu.: 6.00   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:2.303  \n Median :10.50   Median :1.0000   Median :0.0000   Median :2.800  \n Mean   :12.88   Mean   :0.7143   Mean   :0.4762   Mean   :2.930  \n 3rd Qu.:18.50   3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:3.490  \n Max.   :35.00   Max.   :1.0000   Max.   :1.0000   Max.   :5.000  \n       Rx     \n Min.   :0.0  \n 1st Qu.:0.0  \n Median :0.5  \n Mean   :0.5  \n 3rd Qu.:1.0  \n Max.   :1.0  \n```\n:::\n:::\n\n\n## Ajuste Não Paramétrico\n\n\n::: {.cell}\n\n```{.r .cell-code}\nekm <- survfit(Surv(tempo,status)~Rx, data=dados)\ntempo <- ekm$time\nst <- ekm$surv\nsummary(ekm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall: survfit(formula = Surv(tempo, status) ~ Rx, data = dados)\n\n                Rx=0 \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    6     21       3    0.857  0.0764        0.720        1.000\n    7     17       1    0.807  0.0869        0.653        0.996\n   10     15       1    0.753  0.0963        0.586        0.968\n   13     12       1    0.690  0.1068        0.510        0.935\n   16     11       1    0.627  0.1141        0.439        0.896\n   22      7       1    0.538  0.1282        0.337        0.858\n   23      6       1    0.448  0.1346        0.249        0.807\n\n                Rx=1 \n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    1     21       2   0.9048  0.0641      0.78754        1.000\n    2     19       2   0.8095  0.0857      0.65785        0.996\n    3     17       1   0.7619  0.0929      0.59988        0.968\n    4     16       2   0.6667  0.1029      0.49268        0.902\n    5     14       2   0.5714  0.1080      0.39455        0.828\n    8     12       4   0.3810  0.1060      0.22085        0.657\n   11      8       2   0.2857  0.0986      0.14529        0.562\n   12      6       2   0.1905  0.0857      0.07887        0.460\n   15      4       1   0.1429  0.0764      0.05011        0.407\n   17      3       1   0.0952  0.0641      0.02549        0.356\n   22      2       1   0.0476  0.0465      0.00703        0.322\n   23      1       1   0.0000     NaN           NA           NA\n```\n:::\n\n```{.r .cell-code}\nplot(ekm, xlab=\"T(semanas)\",ylab=\"S(t)\", lty=2:3)\nlegend(\"topright\",c(\"Rx=0\",\"Rx=1\"), lty = 2:3)\n```\n\n::: {.cell-output-display}\n![](Aula08_files/figure-html/ex_2-1.png){width=960}\n:::\n:::\n\n\n## Modelo Semi-paramétrico de Cox\n\n\n::: {.cell}\n\n```{.r .cell-code}\nleuc.cox1 <- coxph(Surv(tempo, status) ~ sexo + logwbc + Rx, data = dados)\nsummary(leuc.cox1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(tempo, status) ~ sexo + logwbc + Rx, data = dados)\n\n  n= 42, number of events= 30 \n\n         coef exp(coef) se(coef)     z Pr(>|z|)    \nsexo   0.3147    1.3698   0.4545 0.692  0.48872    \nlogwbc 1.6819    5.3760   0.3366 4.997 5.82e-07 ***\nRx     1.5036    4.4978   0.4615 3.258  0.00112 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n       exp(coef) exp(-coef) lower .95 upper .95\nsexo       1.370     0.7300    0.5621     3.338\nlogwbc     5.376     0.1860    2.7794    10.398\nRx         4.498     0.2223    1.8204    11.113\n\nConcordance= 0.851  (se = 0.041 )\nLikelihood ratio test= 47.19  on 3 df,   p=3e-10\nWald test            = 33.54  on 3 df,   p=2e-07\nScore (logrank) test = 48.01  on 3 df,   p=2e-10\n```\n:::\n:::\n\n\n## Automatizando ajuste\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)\nleuc.cox2 <- stepAIC(leuc.cox1, direction=\"backward\", trace=FALSE)\nsummary(leuc.cox2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(tempo, status) ~ logwbc + Rx, data = dados)\n\n  n= 42, number of events= 30 \n\n         coef exp(coef) se(coef)     z Pr(>|z|)    \nlogwbc 1.6909    5.4243   0.3359 5.034  4.8e-07 ***\nRx     1.3861    3.9991   0.4248 3.263   0.0011 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n       exp(coef) exp(-coef) lower .95 upper .95\nlogwbc     5.424     0.1844     2.808    10.478\nRx         3.999     0.2501     1.739     9.195\n\nConcordance= 0.852  (se = 0.04 )\nLikelihood ratio test= 46.71  on 2 df,   p=7e-11\nWald test            = 33.6  on 2 df,   p=5e-08\nScore (logrank) test = 46.07  on 2 df,   p=1e-10\n```\n:::\n:::\n\n\n## Informações do Ajuste\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoef(leuc.cox2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  logwbc       Rx \n1.690890 1.386076 \n```\n:::\n\n```{.r .cell-code}\nlogLik(leuc.cox2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'log Lik.' -69.8281 (df=2)\n```\n:::\n:::\n\n\n## Avaliando o ajuste 1\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rms)\nsurvplot(npsurv(Surv(tempo, status) ~ Rx, data = dados),\nloglog = TRUE, logt=TRUE, xlab = \"Tempo\", ylab = \"log(-log(S))\")\n```\n\n::: {.cell-output-display}\n![](Aula08_files/figure-html/unnamed-chunk-4-1.png){width=960}\n:::\n:::\n\n\n## Avaliando o ajuste 2\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survminer)\nponto <- surv_cutpoint(dados, time = \"tempo\", event = \"status\", variables = \"logwbc\")\nponto$cutpoint[1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       cutpoint\nlogwbc     2.73\n```\n:::\n\n```{.r .cell-code}\ndados$grupolwbc <- cut(dados$logwbc,ponto$cutpoint[1])\nsurvplot(npsurv(Surv(tempo, status) ~ grupolwbc, data = dados),\nloglog = TRUE, logt=TRUE, xlab = \"Tempo\", ylab = \"log(-log(S))\")\n```\n\n::: {.cell-output-display}\n![](Aula08_files/figure-html/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\n\n## Curva de Sobrevivência\n\n\n::: {.cell}\n\n```{.r .cell-code}\namostra <- data.frame(\nRx = c(0, 1), logwbc = rep(mean(dados$logwbc), 2))\namostra.surv <- survfit(leuc.cox2, newdata = amostra)\nplot(amostra.surv, col = c(1, 2), conf.int = TRUE,\nxlab = \"Tempo\", ylab = \"S(t)\")\nlegend(\"bottomleft\", bty = \"n\", lty = 1, col = 1:2,\nlegend = sprintf(\"Rx %d\", 0:1))\n```\n\n::: {.cell-output-display}\n![](Aula08_files/figure-html/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n",
    "supporting": [
      "Aula08_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}