{
  "hash": "1b144a3f73963e60f02c4c06952015f8",
  "result": {
    "markdown": "---\ntitle: \"Análise de Sobrevivência\"\nsubtitle: \"Modelos não Paramétricos\"\nauthor: \"Prof. Ricardo Accioly\"\nformat:\n html:\n    code-link: true\n    fig-width: 9\n    fig-height: 7\n    fig-dpi: 300\nknitr:\n  opts_chunk: \n    out.width: 90%\n    comment: \"#>\"\n---\n\n\n## Análise de Sobrevivência\n\nNesta apresentação vamos ver passo a passo como obter uma estimativa da curva de sobrevivência através do método de Kaplan-Meier.\n\nVamos inicialmente utilizar o pacote `survival` que é a principal referência em modelos de análise de sobrevivência.\n\nVamos usar neste exemplo dados de pacientes com leucemia.\n\nO objetivo é verificar se o tratamento proposto, 6MP, tem efeito sobre a doença.\n\nExistem dois grupos de pacientes:\n\n-   21 receberam 6MP que é um medicamento para tratar leucemia\n-   Os outros 21 receberam placebo.\n\n::: {.fragment .highlight-red}\nO evento falha aqui é ocorrer uma recaída na doença.\n:::\n\n## Método de KM - 6MP\n\n::: panel-tabset\n### Ajuste KM\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nlibrary(survival)\ntempos<- c(6,6,6,6,7,9,10,10,11,13,16,17,19,20,22,23,25,32,32,34,35)\nstatus<- c(1,1,1,0,1,0,1,0,0,1,1,0,0,0,1,1,0,0,0,0,0)\ndados <- data.frame(tempos=tempos, status=status)\najusteKM <- survfit(Surv(tempos, status) ~ 1, data=dados)\n```\n````\n:::\n\n\n### Grafico\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(ajusteKM, xlab=\"Tempo (semanas)\",ylab=\"S(t)\", lty=1, col=1, lwd=2 ) \nlegend(\"topright\",\"6-MP\", lty = 1, col = 1, lwd=2)\n```\n\n::: {.cell-output-display}\n![](Aula01_files/figure-html/unnamed-chunk-2-1.png){width=90%}\n:::\n:::\n\n:::\n\n## Método de KM - 6MP\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nsummary(ajusteKM)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call: survfit(formula = Surv(tempos, status) ~ 1, data = dados)\n#> \n#>  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#>     6     21       3    0.857  0.0764        0.720        1.000\n#>     7     17       1    0.807  0.0869        0.653        0.996\n#>    10     15       1    0.753  0.0963        0.586        0.968\n#>    13     12       1    0.690  0.1068        0.510        0.935\n#>    16     11       1    0.627  0.1141        0.439        0.896\n#>    22      7       1    0.538  0.1282        0.337        0.858\n#>    23      6       1    0.448  0.1346        0.249        0.807\n```\n:::\n:::\n\n\n## Método de KM - Placebo\n\n::: panel-tabset\n### Ajuste\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ntempo2<- c(1,1,2,2,3,4,4,5,5,8,8,8,8,11,11,12,12,15,17,22,23)\nstatus2<- c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1) \ndados2 <- data.frame(tempos=tempo2, status=status2)\najusteKM2 <- survfit(Surv(tempos, status) ~ 1, data=dados2)\n```\n````\n:::\n\n\n### Gráfico\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(ajusteKM2, xlab=\"t(semanas)\",ylab=\"S(t)\", lty=1, col=2, lwd=2 ) \nlegend(\"topright\",\"Placebo\", lty = 1, col=2, lwd=2)\n```\n\n::: {.cell-output-display}\n![](Aula01_files/figure-html/unnamed-chunk-5-1.png){width=90%}\n:::\n:::\n\n:::\n\n## Método de KM - Placebo\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nsummary(ajusteKM2)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call: survfit(formula = Surv(tempos, status) ~ 1, data = dados2)\n#> \n#>  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#>     1     21       2   0.9048  0.0641      0.78754        1.000\n#>     2     19       2   0.8095  0.0857      0.65785        0.996\n#>     3     17       1   0.7619  0.0929      0.59988        0.968\n#>     4     16       2   0.6667  0.1029      0.49268        0.902\n#>     5     14       2   0.5714  0.1080      0.39455        0.828\n#>     8     12       4   0.3810  0.1060      0.22085        0.657\n#>    11      8       2   0.2857  0.0986      0.14529        0.562\n#>    12      6       2   0.1905  0.0857      0.07887        0.460\n#>    15      4       1   0.1429  0.0764      0.05011        0.407\n#>    17      3       1   0.0952  0.0641      0.02549        0.356\n#>    22      2       1   0.0476  0.0465      0.00703        0.322\n#>    23      1       1   0.0000     NaN           NA           NA\n```\n:::\n:::\n\n\n## Análise conjunta\n\n::: panel-tabset\n### Ajuste conjunto\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntempo2g <- c(tempos,tempo2)\nstatus2g <- c(status,status2)\ngrupos <- c(rep(1,21),rep(2,21))\ndados3 <- data.frame(tempos=tempo2g, status=status2g, grupos=grupos)\najusteKM3 <- survfit(Surv(tempos, status) ~ grupos, data=dados3)\n```\n:::\n\n\n### Gráfico\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(ajusteKM3, xlab=\"T(semanas)\",ylab=\"S(t)\", lty=1, \n     col=c(1,2), lwd=2, conf.int=0.95) \nlegend(\"topright\",c(\"6-MP\",\"Placebo\"), lty = 1:1, col=c(1,2), lwd=2)\n```\n\n::: {.cell-output-display}\n![](Aula01_files/figure-html/unnamed-chunk-8-1.png){width=90%}\n:::\n:::\n\n:::\n\n## Método de KM - 6MP e Placebo {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(ajusteKM3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call: survfit(formula = Surv(tempos, status) ~ grupos, data = dados3)\n#> \n#>                 grupos=1 \n#>  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#>     6     21       3    0.857  0.0764        0.720        1.000\n#>     7     17       1    0.807  0.0869        0.653        0.996\n#>    10     15       1    0.753  0.0963        0.586        0.968\n#>    13     12       1    0.690  0.1068        0.510        0.935\n#>    16     11       1    0.627  0.1141        0.439        0.896\n#>    22      7       1    0.538  0.1282        0.337        0.858\n#>    23      6       1    0.448  0.1346        0.249        0.807\n#> \n#>                 grupos=2 \n#>  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#>     1     21       2   0.9048  0.0641      0.78754        1.000\n#>     2     19       2   0.8095  0.0857      0.65785        0.996\n#>     3     17       1   0.7619  0.0929      0.59988        0.968\n#>     4     16       2   0.6667  0.1029      0.49268        0.902\n#>     5     14       2   0.5714  0.1080      0.39455        0.828\n#>     8     12       4   0.3810  0.1060      0.22085        0.657\n#>    11      8       2   0.2857  0.0986      0.14529        0.562\n#>    12      6       2   0.1905  0.0857      0.07887        0.460\n#>    15      4       1   0.1429  0.0764      0.05011        0.407\n#>    17      3       1   0.0952  0.0641      0.02549        0.356\n#>    22      2       1   0.0476  0.0465      0.00703        0.322\n#>    23      1       1   0.0000     NaN           NA           NA\n```\n:::\n:::\n\n\n## Diferentes Tipos de Intervalo de Confiança\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"|7\"}\ntempo2g <- c(tempos,tempo2)\nstatus2g <- c(status,status2)\ngrupos <- c(rep(1,21),rep(2,21))\ndados3 <- data.frame(tempos=tempo2g, status=status2g, grupos=grupos)\najusteKM4 <- survfit(Surv(tempos, status) ~ grupos, data=dados3,\n                     conf.type=\"plain\")\n```\n:::\n\n\n## IC Pleno (Aproximação pela Normal)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(ajusteKM4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call: survfit(formula = Surv(tempos, status) ~ grupos, data = dados3, \n#>     conf.type = \"plain\")\n#> \n#>                 grupos=1 \n#>  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#>     6     21       3    0.857  0.0764        0.707        1.000\n#>     7     17       1    0.807  0.0869        0.636        0.977\n#>    10     15       1    0.753  0.0963        0.564        0.942\n#>    13     12       1    0.690  0.1068        0.481        0.900\n#>    16     11       1    0.627  0.1141        0.404        0.851\n#>    22      7       1    0.538  0.1282        0.286        0.789\n#>    23      6       1    0.448  0.1346        0.184        0.712\n#> \n#>                 grupos=2 \n#>  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#>     1     21       2   0.9048  0.0641       0.7792        1.000\n#>     2     19       2   0.8095  0.0857       0.6416        0.977\n#>     3     17       1   0.7619  0.0929       0.5797        0.944\n#>     4     16       2   0.6667  0.1029       0.4650        0.868\n#>     5     14       2   0.5714  0.1080       0.3598        0.783\n#>     8     12       4   0.3810  0.1060       0.1733        0.589\n#>    11      8       2   0.2857  0.0986       0.0925        0.479\n#>    12      6       2   0.1905  0.0857       0.0225        0.358\n#>    15      4       1   0.1429  0.0764       0.0000        0.293\n#>    17      3       1   0.0952  0.0641       0.0000        0.221\n#>    22      2       1   0.0476  0.0465       0.0000        0.139\n#>    23      1       1   0.0000     NaN          NaN          NaN\n```\n:::\n:::\n\n\n## IC log - Padrão do R \n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM5 <- survfit(Surv(tempos, status) ~ grupos, data=dados3,\n                     conf.type=\"log\")\nsummary(ajusteKM5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call: survfit(formula = Surv(tempos, status) ~ grupos, data = dados3, \n#>     conf.type = \"log\")\n#> \n#>                 grupos=1 \n#>  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#>     6     21       3    0.857  0.0764        0.720        1.000\n#>     7     17       1    0.807  0.0869        0.653        0.996\n#>    10     15       1    0.753  0.0963        0.586        0.968\n#>    13     12       1    0.690  0.1068        0.510        0.935\n#>    16     11       1    0.627  0.1141        0.439        0.896\n#>    22      7       1    0.538  0.1282        0.337        0.858\n#>    23      6       1    0.448  0.1346        0.249        0.807\n#> \n#>                 grupos=2 \n#>  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#>     1     21       2   0.9048  0.0641      0.78754        1.000\n#>     2     19       2   0.8095  0.0857      0.65785        0.996\n#>     3     17       1   0.7619  0.0929      0.59988        0.968\n#>     4     16       2   0.6667  0.1029      0.49268        0.902\n#>     5     14       2   0.5714  0.1080      0.39455        0.828\n#>     8     12       4   0.3810  0.1060      0.22085        0.657\n#>    11      8       2   0.2857  0.0986      0.14529        0.562\n#>    12      6       2   0.1905  0.0857      0.07887        0.460\n#>    15      4       1   0.1429  0.0764      0.05011        0.407\n#>    17      3       1   0.0952  0.0641      0.02549        0.356\n#>    22      2       1   0.0476  0.0465      0.00703        0.322\n#>    23      1       1   0.0000     NaN           NA           NA\n```\n:::\n:::\n\n\n## IC log-log - Kalbfleish-Prentice \n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM6 <- survfit(Surv(tempos, status) ~ grupos, data=dados3,\n                     conf.type=\"log-log\")\nsummary(ajusteKM6)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call: survfit(formula = Surv(tempos, status) ~ grupos, data = dados3, \n#>     conf.type = \"log-log\")\n#> \n#>                 grupos=1 \n#>  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#>     6     21       3    0.857  0.0764        0.620        0.952\n#>     7     17       1    0.807  0.0869        0.563        0.923\n#>    10     15       1    0.753  0.0963        0.503        0.889\n#>    13     12       1    0.690  0.1068        0.432        0.849\n#>    16     11       1    0.627  0.1141        0.368        0.805\n#>    22      7       1    0.538  0.1282        0.268        0.747\n#>    23      6       1    0.448  0.1346        0.188        0.680\n#> \n#>                 grupos=2 \n#>  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#>     1     21       2   0.9048  0.0641      0.67005        0.975\n#>     2     19       2   0.8095  0.0857      0.56891        0.924\n#>     3     17       1   0.7619  0.0929      0.51939        0.893\n#>     4     16       2   0.6667  0.1029      0.42535        0.825\n#>     5     14       2   0.5714  0.1080      0.33798        0.749\n#>     8     12       4   0.3810  0.1060      0.18307        0.578\n#>    11      8       2   0.2857  0.0986      0.11656        0.482\n#>    12      6       2   0.1905  0.0857      0.05948        0.377\n#>    15      4       1   0.1429  0.0764      0.03566        0.321\n#>    17      3       1   0.0952  0.0641      0.01626        0.261\n#>    22      2       1   0.0476  0.0465      0.00332        0.197\n#>    23      1       1   0.0000     NaN           NA           NA\n```\n:::\n:::\n\n\n## Outra forma de visualização \n\n::: panel-tabset\n### Survminer\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survminer)\ndados <- data.frame(tempo=tempo2g, status=status2g, grupo= grupos)\najusteKM4 <- survfit(Surv(tempo2g, status2g) ~ grupo, data= dados, conf.type=\"log-log\")\ngraf <- ggsurvplot(ajusteKM4, data = dados, \n           risk.table = TRUE, \n           pval = FALSE, \n           conf.int = TRUE, \n           xlim = c(0,40), \n           xlab = \"Tempo em meses\", \n           ylab = \"S(t)\",\n           break.time.by = 10, \n           ggtheme = theme_light(), \n           risk.table.y.text.col = T, risk.table.y.text = FALSE \n)\n```\n:::\n\n\n### Gráfico\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngraf\n```\n\n::: {.cell-output-display}\n![](Aula01_files/figure-html/unnamed-chunk-15-1.png){width=90%}\n:::\n:::\n\n:::\n\n## Outra forma de sumário \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurv_summary(ajusteKM4)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in .get_data(x, data = data): The `data` argument is not provided. Data\n#> will be extracted from model fit.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#>    time n.risk n.event n.censor       surv    std.err     upper       lower\n#> 1     6     21       3        1 0.85714286 0.08908708 0.9515517 0.619717955\n#> 2     7     17       1        0 0.80672269 0.10776353 0.9228090 0.563146565\n#> 3     9     16       0        1 0.80672269 0.10776353 0.9228090 0.563146565\n#> 4    10     15       1        1 0.75294118 0.12796438 0.8893618 0.503199511\n#> 5    11     13       0        1 0.75294118 0.12796438 0.8893618 0.503199511\n#> 6    13     12       1        0 0.69019608 0.15475995 0.8490660 0.431610222\n#> 7    16     11       1        0 0.62745098 0.18177335 0.8049122 0.367510856\n#> 8    17     10       0        1 0.62745098 0.18177335 0.8049122 0.367510856\n#> 9    19      9       0        1 0.62745098 0.18177335 0.8049122 0.367510856\n#> 10   20      8       0        1 0.62745098 0.18177335 0.8049122 0.367510856\n#> 11   22      7       1        0 0.53781513 0.23843463 0.7467907 0.267778937\n#> 12   23      6       1        0 0.44817927 0.30030719 0.6801426 0.188052006\n#> 13   25      5       0        1 0.44817927 0.30030719 0.6801426 0.188052006\n#> 14   32      4       0        2 0.44817927 0.30030719 0.6801426 0.188052006\n#> 15   34      2       0        1 0.44817927 0.30030719 0.6801426 0.188052006\n#> 16   35      1       0        1 0.44817927 0.30030719 0.6801426 0.188052006\n#> 17    1     21       2        0 0.90476190 0.07079923 0.9752941 0.670045882\n#> 18    2     19       2        0 0.80952381 0.10585122 0.9238888 0.568905060\n#> 19    3     17       1        0 0.76190476 0.12198751 0.8932571 0.519391415\n#> 20    4     16       2        0 0.66666667 0.15430335 0.8250440 0.425350436\n#> 21    5     14       2        0 0.57142857 0.18898224 0.7492407 0.337976954\n#> 22    8     12       4        0 0.38095238 0.27817432 0.5777887 0.183066549\n#> 23   11      8       2        0 0.28571429 0.34503278 0.4818196 0.116561326\n#> 24   12      6       2        0 0.19047619 0.44986771 0.3774349 0.059481701\n#> 25   15      4       1        0 0.14285714 0.53452248 0.3211616 0.035657355\n#> 26   17      3       1        0 0.09523810 0.67259271 0.2612500 0.016259260\n#> 27   22      2       1        0 0.04761905 0.97590007 0.1970449 0.003324463\n#> 28   23      1       1        0 0.00000000        Inf        NA          NA\n#>     strata grupo\n#> 1  grupo=1     1\n#> 2  grupo=1     1\n#> 3  grupo=1     1\n#> 4  grupo=1     1\n#> 5  grupo=1     1\n#> 6  grupo=1     1\n#> 7  grupo=1     1\n#> 8  grupo=1     1\n#> 9  grupo=1     1\n#> 10 grupo=1     1\n#> 11 grupo=1     1\n#> 12 grupo=1     1\n#> 13 grupo=1     1\n#> 14 grupo=1     1\n#> 15 grupo=1     1\n#> 16 grupo=1     1\n#> 17 grupo=2     2\n#> 18 grupo=2     2\n#> 19 grupo=2     2\n#> 20 grupo=2     2\n#> 21 grupo=2     2\n#> 22 grupo=2     2\n#> 23 grupo=2     2\n#> 24 grupo=2     2\n#> 25 grupo=2     2\n#> 26 grupo=2     2\n#> 27 grupo=2     2\n#> 28 grupo=2     2\n```\n:::\n:::\n",
    "supporting": [
      "Aula01_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}