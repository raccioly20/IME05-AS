{
  "hash": "e78c10205c4b2b6db7fa91a12c3bc091",
  "result": {
    "markdown": "---\ntitle: \"Análise de Sobrevivência\"\nsubtitle: \"Modelos SemiParamétrico de Cox\"\nauthor: \"Ricardo Accioly\"\nformat:\n  revealjs:\n    theme: dark\n    slide-number: true\n    chalkboard: \n      buttons: false\n    preview-links: auto\n    css: styles.css\n---\n\n\n## Diagnóstico do modelo de Cox {.smaller .scrollable}\n\nO conjunto de dados carregados a seguir são de 238 pacientes viciados com heroína.\n\nOs pacientes foram tratados em duas clínicas (1 e 2), além disso foram coletadas informações sobre dose de medicamento ministrado no tratamento e se o paciente já havia sido preso ou não.\n\nOs tempos (`survt`) são em dias e o evento analisado foi o tempo até a saída da clínica (status=1) ou o tempo até o término de estudo (tempo censurado (status=0).\n\n-   id: Identificação do paciente\n-   clinic: clinica em que ocorreu o tratamento\n-   survt: tempo até a saída da clínica (dias)\n-   status: censoring status 0=censored (censurado), 1=evento\n-   prison: 0= se nunca foi preso e 1= se já foi preso\n-   dose: dose do medicamento ministradp\n\n## Carregando os dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survival)\nlibrary(readxl)\ndados <- read_xlsx(\"heroina.xlsx\", col_names = TRUE )\nstr(dados)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntibble [238 × 6] (S3: tbl_df/tbl/data.frame)\n $ id    : num [1:238] 1 2 3 4 5 6 7 8 9 10 ...\n $ clinic: num [1:238] 1 1 1 1 1 1 1 1 1 1 ...\n $ status: num [1:238] 1 1 1 1 1 1 1 0 1 1 ...\n $ survt : num [1:238] 428 275 262 183 259 714 438 796 892 393 ...\n $ prison: num [1:238] 0 1 0 0 1 0 1 1 0 1 ...\n $ dose  : num [1:238] 50 55 55 30 65 55 65 60 50 65 ...\n```\n:::\n:::\n\n\n## Avaliando presença de dados ausentes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(complete.cases(dados))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 238\n```\n:::\n:::\n\n\n## Ajuste do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\najuste1 <- coxph(Surv(survt,status) ~ clinic + prison + dose,\n                 ties= \"efron\", data=dados)\najuste1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(survt, status) ~ clinic + prison + dose, \n    data = dados, ties = \"efron\")\n\n            coef exp(coef)  se(coef)      z        p\nclinic -1.009896  0.364257  0.214889 -4.700 2.61e-06\nprison  0.326555  1.386184  0.167225  1.953   0.0508\ndose   -0.035369  0.965249  0.006379 -5.545 2.94e-08\n\nLikelihood ratio test=64.56  on 3 df, p=6.229e-14\nn= 238, number of events= 150 \n```\n:::\n:::\n\n\n## Avaliando o modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\namostra.dados <- data.frame(clinic = c(\"1\", \"2\"), prison = rep(0, 2), dose = rep(mean(dados$dose), 2))\namostra.sobr <- survfit(ajuste1, newdata = amostra.dados)\nplot(amostra.sobr, col = c(1, 2), conf.int = TRUE,\nxlab = \"Tempo (dias)\", ylab = \"S(t)\")\nlegend(\"bottomleft\", bty = \"n\", lty = 1, col = 1:2,\nlegend = sprintf(\"clinic %d\", 1:2))\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-revealjs/unnamed-chunk-4-1.png){width=960}\n:::\n:::\n\n\n## Avaliando proporcionalidade\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic.km.clinica <- survfit(Surv(survt, status) ~ clinic, data = dados)\ntabela.vic <- summary(vic.km.clinica)\nplot(tabela.vic$time, log(-log(tabela.vic$surv)),\ncol = tabela.vic$strata, xlab = \"log(t)\", ylab = \"log(-log(S))\",\npch = 20) \n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-revealjs/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\n## Avaliando proporcionalidade\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rms)\nsurvplot(npsurv(Surv(survt, status) ~ clinic, data = dados),\nloglog = TRUE, logt=TRUE, xlab = \"Tempo\", ylab = \"log(-log(S))\")\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-revealjs/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n\n\n## Avaliando o modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvplot(npsurv(Surv(survt, status) ~ prison, data = dados),\nloglog = TRUE, logt=TRUE, xlab = \"Tempo\", ylab = \"log(-log(S))\")\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-revealjs/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n## Avaliando o modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados$dose_60 <- as.integer(dados$dose<=60)\nsurvplot(npsurv(Surv(survt, status) ~ dose_60, data = dados),\nloglog = TRUE, logt=TRUE, xlab = \"Tempo\", ylab = \"log(-log(S))\")\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n## Resíduos de Cox-Snell\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(car)\ncox.snell <- abs(dados$status - ajuste1$residuals)\nqqPlot(cox.snell, dist = \"exp\", rate = mean(cox.snell))\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-revealjs/unnamed-chunk-9-1.png){width=960}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]  9 84\n```\n:::\n:::\n\n\n## Resíduos de Schoenfeld\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncox.zph(ajuste1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        chisq df       p\nclinic 11.159  1 0.00084\nprison  0.839  1 0.35969\ndose    0.515  1 0.47310\nGLOBAL 12.287  3 0.00646\n```\n:::\n:::\n\n\n## Resíduos de Schoenfeld\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresid.sch <- cox.zph(ajuste1)\npar(mfrow=c(1,3))\nplot(resid.sch)\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-revealjs/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n",
    "supporting": [
      "Aula11_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\r\n<script>\r\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\r\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\r\n  // slide changes (different for each slide format).\r\n  (function () {\r\n    // dispatch for htmlwidgets\r\n    function fireSlideEnter() {\r\n      const event = window.document.createEvent(\"Event\");\r\n      event.initEvent(\"slideenter\", true, true);\r\n      window.document.dispatchEvent(event);\r\n    }\r\n\r\n    function fireSlideChanged(previousSlide, currentSlide) {\r\n      fireSlideEnter();\r\n\r\n      // dispatch for shiny\r\n      if (window.jQuery) {\r\n        if (previousSlide) {\r\n          window.jQuery(previousSlide).trigger(\"hidden\");\r\n        }\r\n        if (currentSlide) {\r\n          window.jQuery(currentSlide).trigger(\"shown\");\r\n        }\r\n      }\r\n    }\r\n\r\n    // hookup for slidy\r\n    if (window.w3c_slidy) {\r\n      window.w3c_slidy.add_observer(function (slide_num) {\r\n        // slide_num starts at position 1\r\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\r\n      });\r\n    }\r\n\r\n  })();\r\n</script>\r\n\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}