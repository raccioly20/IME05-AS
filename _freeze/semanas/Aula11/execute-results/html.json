{
  "hash": "e9c73067d106f67a2d8a474a45841fe6",
  "result": {
    "markdown": "---\ntitle: \"Análise de Sobrevivência\"\nsubtitle: \"Modelos SemiParamétrico de Cox\"\nauthor: \"Ricardo Accioly\"\nformat:\n html:\n    code-link: true\n    fig-width: 9\n    fig-height: 7\n    fig-dpi: 300\nknitr:\n  opts_chunk: \n    out.width: 90%\n    comment: \"#>\"\n---\n\n\n## Diagnóstico do modelo de Cox {.smaller .scrollable}\n\nO conjunto de dados carregados a seguir são de 238 pacientes viciados com heroína.\n\nOs pacientes foram tratados em duas clínicas (1 e 2), além disso foram coletadas informações sobre dose de medicamento ministrado no tratamento e se o paciente já havia sido preso ou não.\n\nOs tempos (`survt`) são em dias e o evento analisado foi o tempo até a saída da clínica (status=1) ou o tempo até o término de estudo (tempo censurado (status=0).\n\n-   id: Identificação do paciente\n-   clinic: clinica em que ocorreu o tratamento\n-   survt: tempo até a saída da clínica (dias)\n-   status: censoring status 0=censored (censurado), 1=evento\n-   prison: 0= se nunca foi preso e 1= se já foi preso\n-   dose: dose do medicamento ministradp\n\n## Carregando os dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survival)\nlibrary(readxl)\ndados <- read_xlsx(\"heroina.xlsx\", col_names = TRUE )\nstr(dados)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> tibble [238 × 6] (S3: tbl_df/tbl/data.frame)\n#>  $ id    : num [1:238] 1 2 3 4 5 6 7 8 9 10 ...\n#>  $ clinic: num [1:238] 1 1 1 1 1 1 1 1 1 1 ...\n#>  $ status: num [1:238] 1 1 1 1 1 1 1 0 1 1 ...\n#>  $ survt : num [1:238] 428 275 262 183 259 714 438 796 892 393 ...\n#>  $ prison: num [1:238] 0 1 0 0 1 0 1 1 0 1 ...\n#>  $ dose  : num [1:238] 50 55 55 30 65 55 65 60 50 65 ...\n```\n:::\n:::\n\n\n## Avaliando presença de dados ausentes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(complete.cases(dados))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 238\n```\n:::\n:::\n\n\n## Ajuste do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\najuste1 <- coxph(Surv(survt,status) ~ clinic + prison + dose,\n                 ties= \"efron\", data=dados)\najuste1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> coxph(formula = Surv(survt, status) ~ clinic + prison + dose, \n#>     data = dados, ties = \"efron\")\n#> \n#>             coef exp(coef)  se(coef)      z        p\n#> clinic -1.009896  0.364257  0.214889 -4.700 2.61e-06\n#> prison  0.326555  1.386184  0.167225  1.953   0.0508\n#> dose   -0.035369  0.965249  0.006379 -5.545 2.94e-08\n#> \n#> Likelihood ratio test=64.56  on 3 df, p=6.229e-14\n#> n= 238, number of events= 150\n```\n:::\n:::\n\n\n## Avaliando o modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\namostra.dados <- data.frame(clinic = c(\"1\", \"2\"), prison = rep(0, 2), dose = rep(mean(dados$dose), 2))\namostra.sobr <- survfit(ajuste1, newdata = amostra.dados)\nplot(amostra.sobr, col = c(1, 2), conf.int = TRUE,\nxlab = \"Tempo (dias)\", ylab = \"S(t)\")\nlegend(\"bottomleft\", bty = \"n\", lty = 1, col = 1:2,\nlegend = sprintf(\"clinic %d\", 1:2))\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-html/unnamed-chunk-4-1.png){width=90%}\n:::\n:::\n\n\n## Avaliando proporcionalidade\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic.km.clinica <- survfit(Surv(survt, status) ~ clinic, data = dados)\ntabela.vic <- summary(vic.km.clinica)\nplot(tabela.vic$time, log(-log(tabela.vic$surv)),\ncol = tabela.vic$strata, xlab = \"log(t)\", ylab = \"log(-log(S))\",\npch = 20) \n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-html/unnamed-chunk-5-1.png){width=90%}\n:::\n:::\n\n\n## Avaliando proporcionalidade\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rms)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Carregando pacotes exigidos: Hmisc\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'Hmisc'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following objects are masked from 'package:base':\n#> \n#>     format.pval, units\n```\n:::\n\n```{.r .cell-code}\nsurvplot(npsurv(Surv(survt, status) ~ clinic, data = dados),\nloglog = TRUE, logt=TRUE, xlab = \"Tempo\", ylab = \"log(-log(S))\")\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-html/unnamed-chunk-6-1.png){width=90%}\n:::\n:::\n\n\n## Avaliando o modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvplot(npsurv(Surv(survt, status) ~ prison, data = dados),\nloglog = TRUE, logt=TRUE, xlab = \"Tempo\", ylab = \"log(-log(S))\")\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-html/unnamed-chunk-7-1.png){width=90%}\n:::\n:::\n\n\n## Avaliando o modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados$dose_60 <- as.integer(dados$dose<=60)\nsurvplot(npsurv(Surv(survt, status) ~ dose_60, data = dados),\nloglog = TRUE, logt=TRUE, xlab = \"Tempo\", ylab = \"log(-log(S))\")\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-html/unnamed-chunk-8-1.png){width=90%}\n:::\n:::\n\n\n## Resíduos de Cox-Snell\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(car)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Carregando pacotes exigidos: carData\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'car'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following objects are masked from 'package:rms':\n#> \n#>     Predict, vif\n```\n:::\n\n```{.r .cell-code}\ncox.snell <- abs(dados$status - ajuste1$residuals)\nqqPlot(cox.snell, dist = \"exp\", rate = mean(cox.snell))\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-html/unnamed-chunk-9-1.png){width=90%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1]  9 84\n```\n:::\n:::\n\n\n## Resíduos de Schoenfeld\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncox.zph(ajuste1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>         chisq df       p\n#> clinic 11.159  1 0.00084\n#> prison  0.839  1 0.35969\n#> dose    0.515  1 0.47310\n#> GLOBAL 12.287  3 0.00646\n```\n:::\n:::\n\n\n## Resíduos de Schoenfeld\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresid.sch <- cox.zph(ajuste1)\npar(mfrow=c(1,3))\nplot(resid.sch)\n```\n\n::: {.cell-output-display}\n![](Aula11_files/figure-html/unnamed-chunk-11-1.png){width=90%}\n:::\n:::\n\n\n\n## Estratificação\n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteCoxE <-coxph(Surv(survt,status) ~ strata(clinic) + prison + dose,\n                 ties= \"efron\", data=dados)\nsummary(ajusteCoxE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> coxph(formula = Surv(survt, status) ~ strata(clinic) + prison + \n#>     dose, data = dados, ties = \"efron\")\n#> \n#>   n= 238, number of events= 150 \n#> \n#>             coef exp(coef)  se(coef)      z Pr(>|z|)    \n#> prison  0.389605  1.476397  0.168930  2.306   0.0211 *  \n#> dose   -0.035115  0.965495  0.006465 -5.432 5.59e-08 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#>        exp(coef) exp(-coef) lower .95 upper .95\n#> prison    1.4764     0.6773    1.0603    2.0559\n#> dose      0.9655     1.0357    0.9533    0.9778\n#> \n#> Concordance= 0.651  (se = 0.026 )\n#> Likelihood ratio test= 33.91  on 2 df,   p=4e-08\n#> Wald test            = 32.66  on 2 df,   p=8e-08\n#> Score (logrank) test = 33.33  on 2 df,   p=6e-08\n```\n:::\n:::\n",
    "supporting": [
      "Aula11_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}