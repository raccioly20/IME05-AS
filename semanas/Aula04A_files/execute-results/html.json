{
  "hash": "a17ac6a7bd4d5a37f57ca8ba4625d843",
  "result": {
    "markdown": "---\ntitle: \"Análise de Sobrevivência\"\nsubtitle: \"Modelos Paramétricos - Avaliação do ajuste\"\nauthor: \"Ricardo Accioly\"\nformat:\n html:\n    code-link: true\n    fig-width: 9\n    fig-height: 7\n    fig-dpi: 300\nknitr:\n  opts_chunk: \n    out.width: 90%\n    comment: \"#>\"\n---\n\n\n## Modelos Paramétricos\n\nNeste exemplo são considerados os tempos de reincidência, em semanas, de um grupo de 20 pacientes com cancer de bexiga que foram submetidos a um procedimento cirurgico feito por laser.\n\nVamos ver passo a passo como ajustar os modelos exponencial, Weibull e lognormal.\n\nAqui vamos utilizar as funções existentes no pacote `survival`.\n\nPara ajustar um modelo paramétrico usamo a função `survreg`.\n\n## Metodo de Kaplan-Meier\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survival)\ntempos<-c(9,13,13,18,23,28,31,34,150,48,161,5,5,8,8,12,16,23,27,30,33,43,150)\ncens<-c(1,1,0,1,1,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,1)\ndados <- data.frame(tempos=tempos, status=cens, grupo=c(rep(1,11), rep(2,12)))\nekm <- survfit(Surv(tempos,status)~1, data=dados)\nsummary(ekm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call: survfit(formula = Surv(tempos, status) ~ 1, data = dados)\n#> \n#>  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#>     5     23       2    0.913  0.0588       0.8049        1.000\n#>     8     21       2    0.826  0.0790       0.6848        0.996\n#>     9     19       1    0.783  0.0860       0.6310        0.971\n#>    12     18       1    0.739  0.0916       0.5798        0.942\n#>    13     17       1    0.696  0.0959       0.5309        0.912\n#>    18     14       1    0.646  0.1011       0.4753        0.878\n#>    23     13       2    0.547  0.1073       0.3721        0.803\n#>    27     11       1    0.497  0.1084       0.3240        0.762\n#>    30      9       1    0.442  0.1095       0.2717        0.718\n#>    31      8       1    0.386  0.1089       0.2225        0.671\n#>    33      7       1    0.331  0.1064       0.1765        0.622\n#>    34      6       1    0.276  0.1020       0.1338        0.569\n#>    43      5       1    0.221  0.0954       0.0947        0.515\n#>    48      4       1    0.166  0.0860       0.0598        0.458\n#>   150      3       1    0.110  0.0730       0.0302        0.403\n```\n:::\n:::\n\n\n## Curva de Sobrevivência não paramétrica\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(ekm, xlab=\"Tempo (semanas)\",ylab=\"S(t) estimada\")\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-2-1.png){width=90%}\n:::\n:::\n\n\n## Taxa de Falhas não paramétrica\n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM <- survfit(Surv(tempos, status) ~ 1, data=dados)\najusteKM_sum <- summary(ajusteKM)\npesos <- ajusteKM_sum$n.event/ajusteKM_sum$n.risk\nh <- density(ajusteKM_sum$time, weights = pesos, \n             kernel = \"gaussian\", n = 100, from = 0, to = 150)\nplot(h$x, h$y, type = \"l\", xlab = \"Tempo (semanas)\", ylab = \"Taxa de Falhas\")\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-3-1.png){width=90%}\n:::\n:::\n\n\n## Quantis não parametricos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survey)\ndados_p <- svydesign(ids = ~1, data=dados)\ndados_svykm <- svykm(Surv(tempos, status) ~ 1, dados_p, se=TRUE)\nmediana.km <- quantile(dados_svykm, 0.5, ci=TRUE)\nmed.km <- c(mediana.km[1], attr(mediana.km, \"ci\")[1], attr(mediana.km, \"ci\")[2])\nnames(med.km) <- c(\"mediana KM\",\"ICI\",\"ICS\")\nmed.km\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> mediana KM        ICI        ICS \n#>         30         18         48\n```\n:::\n:::\n\n\n## Modelo Exponencial\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustExp <- survreg(Surv(tempos,status)~1, \n                    data=dados, dist='exponential')\najustExp\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> survreg(formula = Surv(tempos, status) ~ 1, data = dados, dist = \"exponential\")\n#> \n#> Coefficients:\n#> (Intercept) \n#>      3.8986 \n#> \n#> Scale fixed at 1 \n#> \n#> Loglik(model)= -88.2   Loglik(intercept only)= -88.2\n#> n= 23\n```\n:::\n\n```{.r .cell-code}\nalfa <- exp(ajustExp$coefficients[1])\nalfa\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> (Intercept) \n#>    49.33333\n```\n:::\n:::\n\n\n## Taxa de falhas NP vs Exp\n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM <- survfit(Surv(tempos, status) ~ 1, data=dados)\najusteKM_sum <- summary(ajusteKM)\npesos <- ajusteKM_sum$n.event/ajusteKM_sum$n.risk\nh <- density(ajusteKM_sum$time, weights = pesos, \n             kernel = \"gaussian\", n = 100, from = 0, to = 150)\nplot(h$x, h$y, type = \"l\", xlab = \"Tempo (semanas)\", ylab = \"Taxa de Falhas\")\nexpHaz <- function(x, rate) { \n  dexp(x, rate=rate)/\n    pexp(x, rate=rate, lower.tail=F)\n}\ncurve(expHaz(x, rate=1/alfa), from=0, to=150,\n      ylab=\"h(t)\", xlab=\"Tempo\", \n      col=\"red\", ylim=c(0,1),\n      add=TRUE)\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-6-1.png){width=90%}\n:::\n:::\n\n\n## Quantis do Modelo Exponencial\n\n::: panel-tabset\n### Cálculos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nest_med <- predict(ajustExp,type=\"uquantile\",p=0.5,se.fit=T)\nest_med1 <- est_med$fit[1]\nest_med1.ep <- est_med$se.fit[1]\n\nIC.mediana_exp <- c(exp(est_med1),exp(est_med1-1.96*est_med1.ep),\nexp(est_med1+1.96*est_med1.ep))\nnames(IC.mediana_exp) <- c(\"mediana Exp\",\"ICI\",\"ICS\")\n```\n:::\n\n\n### Resultados\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#IC Mediana\nIC.mediana_exp\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> mediana Exp         ICI         ICS \n#>    34.19526    21.54429    54.27499\n```\n:::\n:::\n\n:::\n\n## Avaliação do modelo Exponencial\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(car)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Carregando pacotes exigidos: carData\n```\n:::\n\n```{.r .cell-code}\nn.censurado <- dados$tempos[dados$status == 1]\nqqPlot(n.censurado,\ndist = \"exp\",\nrate = 1/alfa,\nxlab = \"Quantis Teoricos (exponencial)\",\nylab = \"Quantis Empiricos\")\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-9-1.png){width=90%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 18  8\n```\n:::\n:::\n\n\n## Modelo Weibull\n\n::: panel-tabset\n### Ajuste do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustWei <- survreg(Surv(tempos,status)~1, data=dados, dist='weibull')\najustWei\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> survreg(formula = Surv(tempos, status) ~ 1, data = dados, dist = \"weibull\")\n#> \n#> Coefficients:\n#> (Intercept) \n#>    3.875751 \n#> \n#> Scale= 1.101577 \n#> \n#> Loglik(model)= -88   Loglik(intercept only)= -88\n#> n= 23\n```\n:::\n\n```{.r .cell-code}\nalfaw <- exp(ajustWei$coefficients[1])\nbetaw <- 1/ajustWei$scale\n```\n:::\n\n\n### Parametros do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Alfa - parametro de escala\nalfaw\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> (Intercept) \n#>    48.21892\n```\n:::\n\n```{.r .cell-code}\n# Beta - parametro de forma\nbetaw\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.9077897\n```\n:::\n:::\n\n:::\n\n## Taxa de Falhas NP vs Weibull\n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM <- survfit(Surv(tempos, status) ~ 1, data=dados)\najusteKM_sum <- summary(ajusteKM)\npesos <- ajusteKM_sum$n.event/ajusteKM_sum$n.risk\nh <- density(ajusteKM_sum$time, weights = pesos, \n             kernel = \"gaussian\", n = 100, from = 0, to = 150)\nplot(h$x, h$y, type = \"l\", xlab = \"Tempo (semanas)\", ylab = \"Taxa de Falhas\",\n     ylim=c(0,0.10))\nweibHaz <- function(x, shape, scale) { \n  dweibull(x, shape=shape, scale=scale)/\n  pweibull(x, shape=shape, scale=scale,\n           lower.tail=F)\n}\ncurve(weibHaz(x, shape=betaw, scale=alfaw), \n      from=0, to=150,\n      ylab=\"h(t)\", xlab=\"Tempo\", col=\"red\",\n      add=TRUE)\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-12-1.png){width=90%}\n:::\n:::\n\n\n## Quantis do Modelo Weibull\n\n::: panel-tabset\n### Cálculos\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustWei <- survreg(Surv(tempos,status)~1, data=dados, dist='weibull')\nestmedw <- predict(ajustWei,type=\"uquantile\",p=0.5,se.fit=T)\nestmedw1 <- estmedw$fit[1]\nestmedw1.ep <- estmedw$se.fit[1]\nIC.mediana_w <- c(exp(estmedw1),exp(estmedw1-1.96*estmedw1.ep),\nexp(estmedw1+1.96*estmedw1.ep))\nnames(IC.mediana_w) <- c(\"mediana Wei\",\"ICI\",\"ICS\")\n```\n:::\n\n\n### Resultados\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Mediana\nIC.mediana_w\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> mediana Wei         ICI         ICS \n#>    32.20138    18.58445    55.79549\n```\n:::\n:::\n\n:::\n\n## Avaliação do Modelo Weibull\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn.censurado <- dados$tempos[dados$status == 1]\nqqPlot(n.censurado,\ndist = \"weibull\",\nshape = betaw,\nscale = alfaw,\nxlab = \"Quantis Teoricos (Weibull)\",\nylab = \"Quantis Empiricos\")\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-15-1.png){width=90%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 18  8\n```\n:::\n:::\n\n\n## Modelo Lognormal\n\n::: panel-tabset\n### Ajuste do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustLog <- survreg(Surv(tempos, status)~1, data=dados, dist='lognorm')\najustLog\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> survreg(formula = Surv(tempos, status) ~ 1, data = dados, dist = \"lognorm\")\n#> \n#> Coefficients:\n#> (Intercept) \n#>    3.327415 \n#> \n#> Scale= 1.109202 \n#> \n#> Loglik(model)= -85.1   Loglik(intercept only)= -85.1\n#> n= 23\n```\n:::\n\n```{.r .cell-code}\nmulog <- ajustLog$icoef[1]\nsigmalog <- ajustLog$scale\n```\n:::\n\n\n### Parametros do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Media\nmulog\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> (Intercept) \n#>    3.327415\n```\n:::\n\n```{.r .cell-code}\n# Desvio padrão\nsigmalog\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 1.109202\n```\n:::\n:::\n\n:::\n\n## Taxa de Falhas NP vs Lognormal\n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM <- survfit(Surv(tempos, status) ~ 1, data=dados)\najusteKM_sum <- summary(ajusteKM)\npesos <- ajusteKM_sum$n.event/ajusteKM_sum$n.risk\nh <- density(ajusteKM_sum$time, weights = pesos, \n             kernel = \"gaussian\", n = 100, from = 0, to = 150)\nplot(h$x, h$y, type = \"l\", xlab = \"Tempo (semanas)\", ylab = \"Taxa de Falhas\",\n     ylim=c(0,0.10))\nlogHaz <- function(x, meanlog, sdlog) {\n  dlnorm(x, meanlog=meanlog, sdlog=sdlog)/\n  plnorm(x, meanlog=meanlog, sdlog=sdlog, \n         lower.tail=F)\n}\ncurve(logHaz(x, meanlog=mulog, sdlog=sigmalog), from=0, to=150,\n      ylab=\"h(t)\", xlab=\"Tempo\", \n      col=\"red\",\n      add=TRUE)\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-18-1.png){width=90%}\n:::\n:::\n\n\n## Quantis do Modelo Lognormal\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustLog <- survreg(Surv(tempos, status)~1, data=dados, dist='lognorm')\nestmedl <- predict(ajustLog,type=\"uquantile\",p=0.5,se.fit=T)\nestmedl1 <- estmedl$fit[1]\nestmedl1.ep <- estmedl$se.fit[1]\nIC.mediana_log <- c(exp(estmedl1),exp(estmedl1-1.96*estmedl1.ep),\nexp(estmedl1+1.96*estmedl1.ep))\nnames(IC.mediana_log) <- c(\"mediana Logn\",\"ICI\",\"ICS\")\nIC.mediana_log\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> mediana Logn          ICI          ICS \n#>     27.86621     17.32943     44.80965\n```\n:::\n:::\n\n\n## Avaliação do Modelo Lognormal\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn.censurado <- dados$tempos[dados$status == 1]\nqqPlot(n.censurado,\ndist = \"lnorm\",\nmeanlog = mulog,\nsdlog = sigmalog,\nxlab = \"Quantis Teoricos (Lognormal)\",\nylab = \"Quantis Empiricos\")\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-20-1.png){width=90%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 18  8\n```\n:::\n:::\n\n\n## Modelo Loglogístico\n\n::: panel-tabset\n### Ajuste do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustLLog <- survreg(Surv(tempos, status)~1, data=dados, dist='loglogistic')\najustLLog\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> Call:\n#> survreg(formula = Surv(tempos, status) ~ 1, data = dados, dist = \"loglogistic\")\n#> \n#> Coefficients:\n#> (Intercept) \n#>    3.256546 \n#> \n#> Scale= 0.634186 \n#> \n#> Loglik(model)= -85.1   Loglik(intercept only)= -85.1\n#> n= 23\n```\n:::\n\n```{.r .cell-code}\nbetall<- ajustLLog$icoef[1]\nalfall <- ajustLLog$scale\nmullog <- betall\nsigmallog <- alfall\n```\n:::\n\n\n### Parametros do modelo\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Media\nbetall\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> (Intercept) \n#>    3.256546\n```\n:::\n\n```{.r .cell-code}\n# Desvio padrão\nalfall\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.634186\n```\n:::\n:::\n\n:::\n\n## Taxa de Falhas NP vs Loglogística\n\n\n::: {.cell}\n\n```{.r .cell-code}\najusteKM <- survfit(Surv(tempos, status) ~ 1, data=dados)\najusteKM_sum <- summary(ajusteKM)\npesos <- ajusteKM_sum$n.event/ajusteKM_sum$n.risk\nh <- density(ajusteKM_sum$time, weights = pesos, \n             kernel = \"gaussian\", n = 100, from = 0, to = 150)\nplot(h$x, h$y, type = \"l\", xlab = \"Tempo (semanas)\", ylab = \"Taxa de Falhas\",\n     ylim=c(0,0.15))\nlibrary(flexsurv)\nllogisHaz <- function(x, alfa, beta) {\n  haz <- hllogis(x, shape = beta, scale = alfa, log = FALSE)\n}\ncurve(llogisHaz(x, alfa=alfall, beta=betall), from=0, to=150,\n      ylab=\"h(t)\", xlab=\"Tempo\", col=\"red\", add=TRUE)\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-23-1.png){width=90%}\n:::\n:::\n\n\n## Quantis do Modelo Log-Logístico\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustLLog <- survreg(Surv(tempos, status)~1, data=dados, dist='loglogistic')\nestmedll <- predict(ajustLLog,type=\"uquantile\",p=0.5,se.fit=T)\nestmedll1 <- estmedll$fit[1]\nestmedll1.ep <- estmedll$se.fit[1]\nIC.mediana_llog <- c(exp(estmedll1),exp(estmedll1-1.96*estmedll1.ep),\nexp(estmedll1+1.96*estmedll1.ep))\nnames(IC.mediana_llog) <- c(\"mediana LogL\",\"ICI\",\"ICS\")\nIC.mediana_llog\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> mediana LogL          ICI          ICS \n#>     25.95973     16.34324     41.23464\n```\n:::\n:::\n\n\n## Avaliação do Modelo Log-Logístico\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn.censurado <- dados$tempos[dados$status == 1]\nqqPlot(n.censurado,\n       dist = \"llogis\",\n       shape = betall,\n       scale = alfall,\n       xlab = \"Quantis Teoricos (LogLogistico)\",\n       ylab = \"Quantis Empiricos\")\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-25-1.png){width=90%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 18  8\n```\n:::\n:::\n\n\n## Curvas de Sobrevivência dos Modelos\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntempo <- ekm$time\nst <- ekm$surv\nste <- exp(-tempo/alfa)\nstw <- exp(-(tempo/alfaw)^betaw)\nstln <- pnorm((-log(tempo) + mulog)/sigmalog)\nstll <- plogis((-log(tempo) + mullog)/sigmallog)\ncbind(tempo,st,ste,stw,stln, stll)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>       tempo        st        ste        stw       stln       stll\n#>  [1,]     5 0.9130435 0.90361549 0.88003469 0.93929001 0.93068123\n#>  [2,]     8 0.8260870 0.85030331 0.82217827 0.86972867 0.86484030\n#>  [3,]     9 0.7826087 0.83324094 0.80421117 0.84588006 0.84162443\n#>  [4,]    12 0.7391304 0.78408077 0.75358080 0.77624198 0.77148943\n#>  [5,]    13 0.6956522 0.76834724 0.73768249 0.75408472 0.74848099\n#>  [6,]    16 0.6956522 0.72301571 0.69256708 0.69153396 0.68202995\n#>  [7,]    18 0.6459627 0.69429047 0.66444392 0.65321535 0.64046736\n#>  [8,]    23 0.5465839 0.62737162 0.60008301 0.56868447 0.54757517\n#>  [9,]    27 0.4968944 0.57851124 0.55393724 0.51135599 0.48451643\n#> [10,]    28 0.4968944 0.56690272 0.54306244 0.49827732 0.47021045\n#> [11,]    30 0.4416839 0.54437980 0.52204996 0.47348248 0.44322365\n#> [12,]    31 0.3864734 0.53345616 0.51189761 0.46172842 0.43050454\n#> [13,]    33 0.3312629 0.51226208 0.49226654 0.43941782 0.40651851\n#> [14,]    34 0.2760524 0.50198292 0.48277506 0.42882778 0.39521348\n#> [15,]    43 0.2208420 0.41827272 0.40606758 0.34786949 0.31093531\n#> [16,]    48 0.1656315 0.37795771 0.36939907 0.31197849 0.27503951\n#> [17,]   150 0.1104210 0.04780904 0.06070515 0.06456946 0.05919548\n#> [18,]   161 0.1104210 0.03825376 0.05040692 0.05690381 0.05327807\n```\n:::\n:::\n\n\n## Quantis dos Modelos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(med.km) <- c(\"Mediana\", \"ICI\", \"ICS\")\nquantis <- rbind(med.km, IC.mediana_exp, IC.mediana_w, IC.mediana_log, IC.mediana_llog)\nquantis\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>                  Mediana      ICI      ICS\n#> med.km          30.00000 18.00000 48.00000\n#> IC.mediana_exp  34.19526 21.54429 54.27499\n#> IC.mediana_w    32.20138 18.58445 55.79549\n#> IC.mediana_log  27.86621 17.32943 44.80965\n#> IC.mediana_llog 25.95973 16.34324 41.23464\n```\n:::\n:::\n\n\n## Comparação NP vs Paramétrico\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,2))\nplot(st,ste,pch=16,ylim=range(c(0.0,1)), xlim=range(c(0,1)), xlab = \"S(t): Kaplan-Meier\", ylab=\"S(t): exponencial\")\nlines(c(0,1), c(0,1), type=\"l\", lty=1)\nplot(st,stw,pch=16,ylim=range(c(0.0,1)), xlim=range(c(0,1)), xlab = \"S(t): Kaplan-Meier\",\n     ylab=\"S(t): Weibull\")\nlines(c(0,1), c(0,1), type=\"l\", lty=1)\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-28-1.png){width=90%}\n:::\n:::\n\n\n## Comparação NP vs Paramétrico\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,2))\nplot(st,stln,pch=16,ylim=range(c(0.0,1)), xlim=range(c(0,1)), xlab = \"S(t): Kaplan-Meier\",\n     ylab=\"S(t): Log-normal\")\nlines(c(0,1), c(0,1), type=\"l\", lty=1)\nplot(st,stll,pch=16,ylim=range(c(0.0,1)), xlim=range(c(0,1)), xlab = \"S(t): Kaplan-Meier\",\n     ylab=\"S(t): log-Logistica\")\nlines(c(0,1), c(0,1), type=\"l\", lty=1)\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-29-1.png){width=90%}\n:::\n:::\n\n\n## Comparação NP vs Paramétrico\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,2))\nplot(ekm, conf.int=F, xlab=\"Tempos\", ylab=\"S(t)\")\nlines(c(0,tempo),c(1,ste), lty=2)\nlegend(25,0.8,lty=c(1,2),c(\"Kaplan-Meier\", \"Exponencial\"),bty=\"n\",cex=0.8)\nplot(ekm, conf.int=F, xlab=\"Tempos\", ylab=\"S(t)\")\nlines(c(0,tempo),c(1,stw), lty=2)\nlegend(25,0.8,lty=c(1,2),c(\"Kaplan-Meier\", \"Weibull\"),bty=\"n\",cex=0.8)\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-30-1.png){width=90%}\n:::\n:::\n\n\n## Comparação NP vs Paramétrico\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,2))\nplot(ekm, conf.int=F, xlab=\"Tempos\", ylab=\"S(t)\")\nlines(c(0,tempo),c(1,stln), lty=2)\nlegend(25,0.8,lty=c(1,2),c(\"Kaplan-Meier\", \"Lognormal\"),bty=\"n\",cex=0.8)\nplot(ekm, conf.int=F, xlab=\"Tempos\", ylab=\"S(t)\")\nlines(c(0,tempo),c(1,stll), lty=2)\nlegend(25,0.8,lty=c(1,2),c(\"Kaplan-Meier\", \"LogLogistica\"),bty=\"n\",cex=0.8)\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-31-1.png){width=90%}\n:::\n:::\n\n\n## Modelos Paramétricos\n\n\n::: {.cell}\n\n```{.r .cell-code}\najustExp <- survreg(Surv(tempos,status)~1, data=dados, dist='exponential')\nalfa <- exp(ajustExp$coefficients[1])\najustWei <- survreg(Surv(tempos,status)~1, data=dados, dist='weibull')\nalfaw <- exp(ajustWei$coefficients[1])\nbetaw <- 1/ajustWei$scale\najustLog <- survreg(Surv(tempos,status)~1, data=dados, dist='lognorm')\nmu <- ajustLog$icoef[1]\nsigma <- exp(ajustLog$icoef[2])\najustLogl <- survreg(Surv(tempos,status)~1, data=dados, dist='loglogistic')\nmu1 <- ajustLogl$icoef[1]\nsigma1 <- exp(ajustLogl$icoef[2])\n```\n:::\n\n\n## Avaliação do Modelo Weibull\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab.np <- summary(ekm)\nplot(log(-log(tab.np$surv)) ~ log(tab.np$time),\n     xlab=\"log(t)\", ylab=\"log(-log(S(t)))\", pch=20)\nmod1.lm <- lm(log(-log(tab.np$surv)) ~ log(tab.np$time))\nabline(mod1.lm)\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-33-1.png){width=90%}\n:::\n\n```{.r .cell-code}\nconfint(mod1.lm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>                       2.5 %    97.5 %\n#> (Intercept)      -4.2828851 -3.122890\n#> log(tab.np$time)  0.8481692  1.208094\n```\n:::\n:::\n\n\n## Avaliação do Modelo Lognormal\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab.np <- summary(ekm)\ninvst1 <- qnorm(tab.np$surv)\nplot(invst1 ~ log(tab.np$time),\n     xlab=\"log(t)\", ylab=expression(Phi^-1*(S(t))), pch=20)\nmod2.lm <- lm(invst1 ~ log(tab.np$time))\nabline(mod2.lm)\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-34-1.png){width=90%}\n:::\n:::\n\n\n## Avaliação do Modelo LogLogístico\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab.np <- summary(ekm)\ninvst2 <- qlogis(tab.np$surv) \nplot(invst2 ~ log(tab.np$time),\n     xlab=\"log(t)\", ylab=expression(Phi^-1*Logis*(S(t))), pch=20)\nmod3.lm <- lm(invst2 ~ log(tab.np$time))\nabline(mod3.lm)\n```\n\n::: {.cell-output-display}\n![](Aula04A_files/figure-html/unnamed-chunk-35-1.png){width=90%}\n:::\n:::\n\n\n## Teste de Razão de Verossimilhança\n\nNo nível de significância de 𝛼=0,05 eu rejeito a hipótese de que o parametro de forma seja igual a 1.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab.exp <- summary(ajustExp)\ntab.wei <- summary(ajustWei)\nTRV <- 2*(tab.wei$loglik[1] - tab.exp$loglik[1])\npchisq(TRV, 1, lower.tail = F)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.5693228\n```\n:::\n:::\n\n\n## Calculos do peso do AIC\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab.exp <- summary(ajustExp)\ntab.wei <- summary(ajustWei)\ntab.ln <- summary(ajustLog)\ntab.ll <- summary(ajustLogl)\naic.exp <- -2*tab.exp$loglik[1] + 2*1\naic.wei <- -2*tab.wei$loglik[1] + 2*2\naic.ln <- -2*tab.ln$loglik[1] + 2*2\naic.ll <- -2*tab.ll$loglik[1] + 2*2\naic <- c(aic.exp, aic.wei, aic.ln, aic.ll)\ndelta.aic <- aic - min(aic)\npeso.aic <- exp(-0.5*delta.aic)/sum(exp(-0.5*delta.aic))\n# Usando a função AIC para calcuar o AIC\naic.exp1 <- AIC(ajustExp)\naic.wei1 <- AIC(ajustWei)\naic.ln1 <- AIC(ajustLog)\naic.ll1 <- AIC(ajustLogl)\naic1 <- c(aic.exp1, aic.wei1, aic.ln1, aic.ll1)\naic\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 178.3496 180.0258 174.2856 174.2261\n```\n:::\n\n```{.r .cell-code}\naic1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 178.3496 180.0258 174.2856 174.2261\n```\n:::\n:::\n\n\n## Comparando modelos através do Peso de Akaike\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelos <- data.frame(modelos=c(\"Exponencial\", \"Weibull\",\n                                \"Lognormal\", \"Loglogistico\"),\n                      p_Akaike = peso.aic)\nmodelos\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        modelos   p_Akaike\n#> 1  Exponencial 0.05909587\n#> 2      Weibull 0.02556105\n#> 3    Lognormal 0.45085617\n#> 4 Loglogistico 0.46448692\n```\n:::\n:::\n\n\n## Comparando os modelos através do BIC\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbic.exp <- BIC(ajustExp)\nbic.wei <- BIC(ajustWei)\nbic.ln <- BIC(ajustLog)\nbic.ll <- BIC(ajustLogl)\nmodelos <- data.frame(modelos=c(\"Exponencial\", \"Weibull\",\n                                \"Lognormal\", \"Loglogistico\"),\n                      BIC = c(bic.exp, bic.wei, bic.ln, bic.ll))\nmodelos\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>        modelos      BIC\n#> 1  Exponencial 179.4851\n#> 2      Weibull 182.2968\n#> 3    Lognormal 176.5566\n#> 4 Loglogistico 176.4970\n```\n:::\n:::\n",
    "supporting": [
      "Aula04A_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}